<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  

  
  
  
  
  
  
  <title>Ren</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Ren">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ren">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ren">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>
</head></html>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Ren" rel="home">Ren</a>
      </h1>
      
        <h2 class="site-description hitokoto"></h2>
        <script type="text/javascript" src="https://v1.hitokoto.cn/?encode=js"></script>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                </ul>
            </div>
    </nav>
</header>

      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-linux系统MySql操作" class="post-linux系统MySql操作 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/02/21/linux系统MySql操作/">linux系统MySql操作</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/02/21/linux系统MySql操作/" data-id="cjsk5l58h001ol8vee8t70133" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h3 id="Linux中操作mysql"><a href="#Linux中操作mysql" class="headerlink" title="Linux中操作mysql"></a>Linux中操作mysql</h3><h4 id="1-配置环境变量"><a href="#1-配置环境变量" class="headerlink" title="1.配置环境变量"></a>1.配置环境变量</h4><p>给mysql配置环境变量后我们就可以在dos窗口运行mysql（开启、停止等操作）<br>设置mysql环境变量<br>计算机（右键）-&gt;属性-&gt;高级系统设置-&gt;环境变量-&gt;系统变量（找到名为Path的变量名，双击左键，修改变量值）<br>变量值为mysql的安装路径，我的为C:\Program Files\MySQL\MySQL Server 5.7\bin<br>注意：修改变量值，是在前面添加C:\Program Files\MySQL\MySQL Server 5.7\bin;（注意结尾分号）</p>
<p>检测path是否正确</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo %path%</span><br></pre></td></tr></table></figure>
<p>下面出现path变量值就正确了</p>
<p>补充：<br>dos是磁盘操作系统；命令提示符是dos系统的界面中输入dos命令的提示位置；cmd是xp系统运行其自带dos的命令。<br>cmd和命令提示符：只是系统模拟的dos操作环境，包含c:\windows\system32\ 里的可执行文件。如net.exe ftp.exe tftp.exe at.exe taskmgr.exe 等等。功能远远大于dos </p>
<p>dos：是实实在在的一个操作系统，功能不多，而且基本上cmd都有。优点是脱离了其他操作系统。windows有自己的资源、文件管理系统，限制cmd对一些重要系统资源的访问。而dos就没有这个限制。</p>
<h4 id="2-linux中mysql操作命令"><a href="#2-linux中mysql操作命令" class="headerlink" title="2.linux中mysql操作命令"></a>2.linux中mysql操作命令</h4><h5 id="2-1-首先启动mysql服务"><a href="#2-1-首先启动mysql服务" class="headerlink" title="2.1 首先启动mysql服务"></a>2.1 首先启动mysql服务</h5><h6 id="2-1-1-cmd启动服务"><a href="#2-1-1-cmd启动服务" class="headerlink" title="2.1.1 cmd启动服务"></a>2.1.1 cmd启动服务</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start mysql57(具体名字看你安装mysql时的命名)</span><br></pre></td></tr></table></figure>
<h5 id="2-2-连接mysql"><a href="#2-2-连接mysql" class="headerlink" title="2.2 连接mysql"></a>2.2 连接mysql</h5><p>格式：mysql -h主机地址 -u用户名 －p用户密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 连接到本地的mysql</span><br><span class="line">mysql -uroot -p （回车后提示你输入密码）或者 mysql -uroot -p123456</span><br><span class="line">如果刚安装好MYSQL，超级用户root是没有密码的，故直接回车即可进入到MYSQL中了，MYSQL的提示符是： mysql&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 连接到远程主机上的mysql</span><br><span class="line">mysql -h39.108.58.209 -uroot -p123456</span><br><span class="line">（注:u与root可以不用加空格，其它也一样）</span><br><span class="line"></span><br><span class="line"># 推出mysql命令</span><br><span class="line">exit()回车</span><br></pre></td></tr></table></figure>
<h5 id="2-3-修改密码"><a href="#2-3-修改密码" class="headerlink" title="2.3 修改密码"></a>2.3 修改密码</h5><p>格式：mysqladmin -u用户名 -p旧密码 password 新密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、例1：给root加个密码ab12。首先在DOS下进入目录mysqlbin，然后键入以下命令：</span><br><span class="line"></span><br><span class="line">mysqladmin -uroot -password ab12</span><br><span class="line"></span><br><span class="line">注：因为开始时root没有密码，所以-p旧密码一项就可以省略了。</span><br><span class="line"></span><br><span class="line">2、例2：再将root的密码改为djg345。</span><br><span class="line"></span><br><span class="line">mysqladmin -uroot -pab12 password djg345</span><br></pre></td></tr></table></figure>
<h5 id="2-4-Linux-ubuntu-中安装mysql"><a href="#2-4-Linux-ubuntu-中安装mysql" class="headerlink" title="2.4 Linux(ubuntu)中安装mysql"></a>2.4 Linux(ubuntu)中安装mysql</h5><p>2.4.1 下载mysql</p>
<p>去官网<a href="https:;//www.mysql.com" target="_blank" rel="noopener">MySQL</a>下载-&gt;DOWNLOADS-&gt;Archives-&gt;MySQL Community Server</p>
<p>选择合适版本（5.6.40)复制下载链接（右键复制下载链接）</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1g0ddvo9d7zj30sh0gojt4.jpg" alt=""></p>
<p>在Linux终端中输入：下载tar包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.mysql.com/archives/get/file/mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>2.4.2 解压tar包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>
<p>如果权限不够，则输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf mysql-5.6.40-linux-glibc2.12-x86_64.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>
<p>进入/usr/local/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/</span><br></pre></td></tr></table></figure>
<p>移动到mysql中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv mysql-5.6.40-linux-glibc2.12-x86_64/ mysql</span><br></pre></td></tr></table></figure>
<p>2.4.3添加用户组和用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br></pre></td></tr></table></figure>
<p>2.4.4 创建data目录下mysql文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd mysql/</span><br><span class="line">mkdir ./data/mysql</span><br></pre></td></tr></table></figure>
<p>2.4.5 授权并执行脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql ./</span><br></pre></td></tr></table></figure>
<p>2.4.6 执行安装脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql/data/mysql/</span><br></pre></td></tr></table></figure>
<p>如果报错</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1g0ddy0e01tj31400u07wi.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install libaio-dev</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1g0de2b8svfj31400u04qq.jpg" alt=""></p>
<p>重启系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>安装libaio-dev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install libaio-dev</span><br></pre></td></tr></table></figure>
<p>如果出现</p>
<p><img src="https://i.loli.net/2019/02/21/5c6d8b4401c61.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libaio-dev</span><br></pre></td></tr></table></figure>
<p>再次执行脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql/data/mysql/</span><br></pre></td></tr></table></figure>
<p>2.4.7 复制mysql服务文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
<p>设置目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1g0ded17ji7j311y0lctil.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit /etc/profile</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1g0deg71kp5j311y0lcjy5.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>显示空白</p>
<p>修改当前目录拥有者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
<p>2.4.8 复制mysql的配置文件并重命名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/my-default.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>2.4.9 给mysql添加远程登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>添加以下</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1g0deg71kp5j311y0lcjy5.jpg" alt=""></p>
<p>2.4.10 初始化mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/mysql_install_db --user=mysql</span><br></pre></td></tr></table></figure>
<p>重启系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>2.4.11 启动mysql服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">输入密码</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
<p>2.4.12 登录mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">输入密码</span><br></pre></td></tr></table></figure>
<p>如果出现以下错误</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1g0depdbjf3j30mo0iwwjz.jpg" alt=""></p>
<p>1.重置密码的第一步就是跳过MySQL的密码认证过程，方法如下：</p>
<p>#vim /etc/my.cnf(注：windows下修改的是my.ini)</p>
<p>在文档内搜索mysqld定位到[mysqld]文本段：<br>/mysqld(在vim编辑状态下直接输入该命令可搜索文本内容)</p>
<p>在[mysqld]后面任意一行添加“skip-grant-tables”用来跳过密码验证的过程，如下图所示：</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1g0devsjhfrj307t022744.jpg" alt=""></p>
<p>保存文档并退出：</p>
<p>#:wq</p>
<p>只读文件使用：w !sudo tee %保存</p>
<p>2.接下来我们需要重启MySQL：</p>
<p>/etc/init.d/mysql restart(有些用户可能需要使用/etc/init.d/mysqld restart)</p>
<p>3.重启之后输入mysql即可进入mysql。</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1g0dexxjrnoj30gj068t8w.jpg" alt=""></p>
<p>4.接下来就是用sql来修改root的密码</p>
<p>mysql&gt; use mysql;<br>mysql&gt; update user set password=password(“你的新密码”) where user=”root”;<br>mysql&gt; flush privileges;<br>mysql&gt; quit</p>
<p>到这里root账户就已经重置成新的密码了。</p>
<p>5.编辑my.cnf,去掉刚才添加的内容，然后重启MySQL。大功告成！</p>
<h5 id="2-5操作命令"><a href="#2-5操作命令" class="headerlink" title="2.5操作命令"></a>2.5操作命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"># 列出数据库：</span><br><span class="line">show databases;</span><br><span class="line"># 选择数据库：</span><br><span class="line">use databaseName;</span><br><span class="line"># 列出表格：</span><br><span class="line">show tables；</span><br><span class="line"># 显示表格列的属性：</span><br><span class="line">show columns from tableName；</span><br><span class="line"># 显示表格所有属性</span><br><span class="line">select * from tableName;</span><br><span class="line"># 显示表数据个数</span><br><span class="line">select count(*) from tableName;</span><br><span class="line"># 建立数据库：</span><br><span class="line">source D:\project\coding\spider\day02\maoyan8.sql;(后面为文件的路径)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">匹配字符：可以用通配符_代表任何一个字符，％代表任何字符串;</span><br><span class="line">增加一个字段：alter table tabelName add column fieldName dateType;</span><br><span class="line">增加多个字段：alter table tabelName add column fieldName1 dateType,add columns fieldName2 dateType;</span><br><span class="line">多行命令输入:注意不能将单词断开;当插入或更改数据时，不能将字段的字符串展开到多行里，否则硬回车将被储存到数据中;</span><br><span class="line">增加一个管理员帐户：grant all on *.* to user@localhost identified by &quot;password&quot;;</span><br><span class="line">每条语句输入完毕后要在末尾填加分号&apos;;&apos;，或者填加&apos;\g&apos;也可以；</span><br><span class="line">查询时间：select now();</span><br><span class="line">查询当前用户：select user();</span><br><span class="line">查询数据库版本：select version();</span><br><span class="line">查询当前使用的数据库：select database();</span><br><span class="line"></span><br><span class="line">1、删除student_course数据库中的students数据表：</span><br><span class="line">rm -f student_course/students.*</span><br><span class="line"></span><br><span class="line">2、备份数据库：(将数据库test备份)</span><br><span class="line">mysqldump -u root -p test&gt;c:\test.txt</span><br><span class="line">备份表格：(备份test数据库下的mytable表格)</span><br><span class="line">mysqldump -u root -p test mytable&gt;c:\test.txt</span><br><span class="line">将备份数据导入到数据库：(导回test数据库)</span><br><span class="line">mysql -u root -p test</span><br><span class="line"></span><br><span class="line">3、创建临时表：(建立临时表zengchao)</span><br><span class="line">create temporary table zengchao(name varchar(10));</span><br><span class="line"></span><br><span class="line">4、创建表是先判断表是否存在</span><br><span class="line">create table if not exists students(……);</span><br><span class="line"></span><br><span class="line">5、从已经有的表中复制表的结构</span><br><span class="line">create table table2 select * from table1 where 1&lt;&gt;1;</span><br><span class="line"></span><br><span class="line">6、复制表</span><br><span class="line">create table table2 select * from table1;</span><br><span class="line"></span><br><span class="line">7、对表重新命名</span><br><span class="line">alter table table1 rename as table2;</span><br><span class="line"></span><br><span class="line">8、修改列的类型</span><br><span class="line">alter table table1 modify id int unsigned;//修改列id的类型为int unsigned</span><br><span class="line">alter table table1 change id sid int unsigned;//修改列id的名字为sid，而且把属性修改为int unsigned</span><br><span class="line"></span><br><span class="line">9、创建索引</span><br><span class="line">alter table table1 add index ind_id (id);</span><br><span class="line">create index ind_id on table1 (id);</span><br><span class="line">create unique index ind_id on table1 (id);//建立唯一性索引</span><br><span class="line"></span><br><span class="line">10、删除索引</span><br><span class="line">drop index idx_id on table1;</span><br><span class="line">alter table table1 drop index ind_id;</span><br><span class="line"></span><br><span class="line">11、联合字符或者多个列(将列id与&quot;:&quot;和列name和&quot;=&quot;连接)</span><br><span class="line">select concat(id,&apos;:&apos;,name,&apos;=&apos;) from students;</span><br><span class="line"></span><br><span class="line">12、limit(选出10到20条)&lt;第一个记录集的编号是0&gt;</span><br><span class="line">select * from students order by id limit 9,10;</span><br><span class="line"></span><br><span class="line">13、MySQL不支持的功能</span><br><span class="line">事务，视图，外键和引用完整性，存储过程和触发器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">14、MySQL会使用索引的操作符号</span><br><span class="line">&lt;,&lt;=,&gt;=,&gt;,=,between,in,不带%或者_开头的like</span><br><span class="line"></span><br><span class="line">15、使用索引的缺点</span><br><span class="line">1)减慢增删改数据的速度；</span><br><span class="line">2）占用磁盘空间；</span><br><span class="line">3）增加查询优化器的负担；</span><br><span class="line">当查询优化器生成执行计划时，会考虑索引，太多的索引会给查询优化器增加工作量，导致无法选择最优的查询方案；</span><br><span class="line"></span><br><span class="line">16、分析索引效率</span><br><span class="line">方法：在一般的SQL语句前加上explain；</span><br><span class="line">分析结果的含义：</span><br><span class="line">1）table：表名；</span><br><span class="line">2）type：连接的类型，(ALL/Range/Ref)。其中ref是最理想的；</span><br><span class="line">3）possible_keys：查询可以利用的索引名；</span><br><span class="line">4）key：实际使用的索引；</span><br><span class="line">5）key_len：索引中被使用部分的长度（字节）；</span><br><span class="line">6）ref：显示列名字或者&quot;const&quot;（不明白什么意思）；</span><br><span class="line">7）rows：显示MySQL认为在找到正确结果之前必须扫描的行数；</span><br><span class="line">8）extra：MySQL的建议；</span><br></pre></td></tr></table></figure>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/02/21/linux系统MySql操作/">
    <time datetime="2019-02-21T01:27:52.000Z" class="entry-date">
        2019-02-21
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爬虫/">爬虫</a></li></ul>

    </footer>
</article>






  
    <article id="post-linux中msql操作" class="post-linux中msql操作 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/02/19/linux中msql操作/">linux中msql操作</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/02/19/linux中msql操作/" data-id="cjsk5l57g0010l8ve996faars" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>环境变量设置：</p>
<blockquote>
<p> 找到C盘mysql安装路径：C:\Program Files\MySQL\MySQL Server 5.7\bin<br> 有机我的电脑  -&gt;  属性  -&gt;  高级系统设置   -&gt;  环境变量 。。。。。。<br> <img src="/images/QQ截图20190219170220.png" alt=""></p>
</blockquote>
<p>在CMD控制台中：</p>
<blockquote>
<p> echo %PATH%                 …查看环境安装<br> mysql                       …mysql<br> mysql -uroot -p123456       …连sql接数据库（123456是密码）<br> source D:\wordspace\爬虫\day04\jingdong.sql   …运行xx.sql文件，执行sql语句<br> mysql databases;            …查看mysql<br> use maoyan;                 …切换maoyan数据库<br> show tables;                …查询maoyan数据库中的表<br> desc movie;                 …查看novie表<br> select count(<em>) from movie; …查询movie表中有多少条数据<br> select </em> from movie;        …查询movie表中有所有的详细信息</p>
</blockquote>
<p>linux系统下，环境变量设置(.bash_profile文件)</p>
<blockquote>
<p> 打开.bash_profile文件<br> <img src="/images/QQ截图20190221101300.png" alt=""><br> 添加路径<br> <img src="/images/QQ截图20190221101402.png" alt=""></p>
</blockquote>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/02/19/linux中msql操作/">
    <time datetime="2019-02-19T08:47:21.000Z" class="entry-date">
        2019-02-19
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爬虫/">爬虫</a></li></ul>

    </footer>
</article>






  
    <article id="linux-操作命令" class="linux-操作命令 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/02/19/操作命令/">操作命令</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/02/19/操作命令/" data-id="cjsk5l58k001ql8ve54a2qsgd" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>转自：<a href="http://www.cnblogs.com/xiaochaohuashengmi/archive/2011/10/18/2216279.html" target="_blank" rel="noopener">http://www.cnblogs.com/xiaochaohuashengmi/archive/2011/10/18/2216279.html</a></p>
<p>1.linux下启动mysql的命令：<br>mysqladmin start<br>/ect/init.d/mysql start (前面为mysql的安装路径)</p>
<p>2.linux下重启mysql的命令：<br>mysqladmin restart<br>/ect/init.d/mysql restart (前面为mysql的安装路径)</p>
<p>3.linux下关闭mysql的命令：<br>mysqladmin shutdown<br>/ect/init.d/mysql shutdown (前面为mysql的安装路径)</p>
<p>4.连接本机上的mysql：<br>进入目录mysql\bin，再键入命令mysql -uroot -p， 回车后提示输入密码。<br>退出mysql命令：exit（回车）</p>
<p>5.修改mysql密码：<br>mysqladmin -u用户名 -p旧密码 password 新密码<br>或进入mysql命令行SET PASSWORD FOR root=PASSWORD(“root”);</p>
<p>6.增加新用户。（注意：mysql环境中的命令后面都带一个分号作为命令结束符）<br>grant select on 数据库.<em> to 用户名@登录主机 identified by “密码”<br>如增加一个用户test密码为123，让他可以在任何主机上登录， 并对所有数据库有查询、插入、修改、删除的权限。首先用以root用户连入mysql，然后键入以下命令：<br>grant select,insert,update,delete on </em>.* to “ Identified by “123”;</p>
<p>二、有关mysql数据库方面的操作<br>必须首先登录到mysql中，有关操作都是在mysql的提示符下进行，而且每个命令以分号结束</p>
<p>1、显示数据库列表。<br>show databases;<br>2、显示库中的数据表：<br>use mysql； ／／打开库<br>show tables;<br>3、显示数据表的结构：<br>describe 表名;<br>4、建库：<br>create database 库名;</p>
<p>GBK: create database test2 DEFAULT CHARACTER SET gbk COLLATE gbk_chinese_ci;<br>UTF8: CREATE DATABASE <code>test2</code> DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;<br>5、建表：<br>use 库名；<br>create table 表名(字段设定列表)；<br>6、删库和删表:<br>drop database 库名;<br>drop table 表名；<br>7、将表中记录清空：<br>delete from 表名;</p>
<p>truncate table  表名;<br>8、显示表中的记录：<br>select * from 表名;</p>
<p>9、编码的修改<br>如果要改变整个mysql的编码格式：<br>启动mysql的时候，mysqld_safe命令行加入<br>–default-character-set=gbk </p>
<p>如果要改变某个库的编码格式：在mysql提示符后输入命令<br>alter database db_name default character set gbk;</p>
<p>10.重命名表</p>
<p>alter table t1 rename t2;</p>
<p>11.查看sql语句的效率</p>
<p> explain &lt; table_name &gt;</p>
<p>例如：explain select * from t3 where id=3952602;</p>
<p>12.用文本方式将数据装入数据库表中(例如D:/mysql.txt)</p>
<p>mysql&gt; LOAD DATA LOCAL INFILE “D:/mysql.txt” INTO TABLE MYTABLE;</p>
<p>三、数据的导入导出</p>
<p>1、文本数据转到数据库中<br>文本数据应符合的格式：字段数据之间用tab键隔开，null值用来代替。例：<br>1 name duty 2006-11-23<br>数据传入命令 load data local infile “文件名” into table 表名;</p>
<p>2、导出数据库和表<br>mysqldump –opt news &gt; news.sql（将数据库news中的所有表备份到news.sql文件，news.sql是一个文本文件，文件名任取。）<br>mysqldump –opt news author article &gt; author.article.sql（将数据库news中的author表和article表备份到author.article.sql文件， author.article.sql是一个文本文件，文件名任取。）<br>mysqldump –databases db1 db2 &gt; news.sql（将数据库dbl和db2备份到news.sql文件，news.sql是一个文本文件，文件名任取。）<br>mysqldump -h host -u user -p pass –databases dbname &gt; file.dump<br>就是把host上的以名字user，口令pass的数据库dbname导入到文件file.dump中<br>mysqldump –all-databases &gt; all-databases.sql（将所有数据库备份到all-databases.sql文件，all-databases.sql是一个文本文件，文件名任取。）</p>
<p>3、导入数据<br>mysql &lt; all-databases.sql（导入数据库）<br>mysql&gt;source news.sql;（在mysql命令下执行，可导入表）</p>
<p>一、连接MySQL<br>格式： mysql -h主机地址 -u用户名 －p用户密码</p>
<p>1、例1：连接到本机上的MYSQL。</p>
<p>首先在打开DOS窗口，然后进入目录 mysqlbin，再键入命令mysql -uroot -p，回车后提示你输密码，如果刚安装好MYSQL，超级用户root是没有密码的，故直接回车即可进入到MYSQL中了，MYSQL的提示符是： mysql&gt;。</p>
<p>2、例2：连接到远程主机上的MYSQL。假设远程主机的IP为：110.110.110.110，用户名为root,密码为abcd123。则键入以下命令：</p>
<p>mysql -h110.110.110.110 -uroot -pabcd123</p>
<p>（注:u与root可以不用加空格，其它也一样）</p>
<p>3、退出MYSQL命令： exit （回车）。</p>
<p>二、修改密码</p>
<p>格式：mysqladmin -u用户名 -p旧密码 password 新密码</p>
<p>1、例1：给root加个密码ab12。首先在DOS下进入目录mysqlbin，然后键入以下命令：</p>
<p>mysqladmin -uroot -password ab12</p>
<p>注：因为开始时root没有密码，所以-p旧密码一项就可以省略了。</p>
<p>2、例2：再将root的密码改为djg345。</p>
<p>mysqladmin -uroot -pab12 password djg345</p>
<p>三、增加新用户。（注意：和上面不同，下面的因为是MySQL环境中的命令，所以后面都带一个分号作为命令结束符）</p>
<p>格式：grant select on 数据库.* to 用户名@登录主机 identified by \”密码\”</p>
<p>例1、增加一个用户test1密码为abc，让他可以在任何主机上登录，并对所有数据库有查询、插入、修改、删除的权限。首先用以root用户连入MySQL，然后键入以下命令：</p>
<p>grant select,insert,update,<br>delete on <em>.</em> to test1@\”%\” Identified by \”abc\”;</p>
<p>但例1增加的用户是十分危险的，你想如某个人知道test1的密码，那么他就可以在internet上的任何一台电脑上登录你的MySQL数据库并对你的数据可以为所欲为了，解决办法见例2。</p>
<p>例2、增加一个用户test2密码为abc,让他只可以在localhost上登录，并可以对数据库mydb进行查询、插入、修改、删除的操作 （localhost指本地主机，即MySQL数据库所在的那台主机），这样用户即使用知道test2的密码，他也无法从internet上直接访问数据 库，只能通过MySQL主机上的web页来访问。</p>
<p>grant select,insert,update,<br>delete on mydb.* to test2@localhost identified by \”abc\”;</p>
<p>如果你不想test2有密码，可以再打一个命令将密码消掉。</p>
<p>grant select,insert,update,delete on mydb<br>.* to test2@localhost identified by \”\”;</p>
<p>启动：net start mySql;<br>进入：mysql -u root -p/mysql -h localhost -u root -p databaseName;<br>列出数据库：show databases;<br>选择数据库：use databaseName;<br>列出表格：show tables；<br>显示表格列的属性：show columns from tableName；<br>建立数据库：source fileName.txt;<br>匹配字符：可以用通配符_代表任何一个字符，％代表任何字符串;<br>增加一个字段：alter table tabelName add column fieldName dateType;<br>增加多个字段：alter table tabelName add column fieldName1 dateType,add columns fieldName2 dateType;<br>多行命令输入:注意不能将单词断开;当插入或更改数据时，不能将字段的字符串展开到多行里，否则硬回车将被储存到数据中;<br>增加一个管理员帐户：grant all on <em>.</em> to user@localhost identified by “password”;<br>每条语句输入完毕后要在末尾填加分号’;’，或者填加’\g’也可以；<br>查询时间：select now();<br>查询当前用户：select user();<br>查询数据库版本：select version();<br>查询当前使用的数据库：select database();</p>
<p>1、删除student_course数据库中的students数据表：<br>rm -f student_course/students.*</p>
<p>2、备份数据库：(将数据库test备份)<br>mysqldump -u root -p test&gt;c:\test.txt<br>备份表格：(备份test数据库下的mytable表格)<br>mysqldump -u root -p test mytable&gt;c:\test.txt<br>将备份数据导入到数据库：(导回test数据库)<br>mysql -u root -p test</p>
<p>3、创建临时表：(建立临时表zengchao)<br>create temporary table zengchao(name varchar(10));</p>
<p>4、创建表是先判断表是否存在<br>create table if not exists students(……);</p>
<p>5、从已经有的表中复制表的结构<br>create table table2 select * from table1 where 1&lt;&gt;1;</p>
<p>6、复制表<br>create table table2 select * from table1;</p>
<p>7、对表重新命名<br>alter table table1 rename as table2;</p>
<p>8、修改列的类型<br>alter table table1 modify id int unsigned;//修改列id的类型为int unsigned<br>alter table table1 change id sid int unsigned;//修改列id的名字为sid，而且把属性修改为int unsigned</p>
<p>9、创建索引<br>alter table table1 add index ind_id (id);<br>create index ind_id on table1 (id);<br>create unique index ind_id on table1 (id);//建立唯一性索引</p>
<p>10、删除索引<br>drop index idx_id on table1;<br>alter table table1 drop index ind_id;</p>
<p>11、联合字符或者多个列(将列id与”:”和列name和”=”连接)<br>select concat(id,’:’,name,’=’) from students;</p>
<p>12、limit(选出10到20条)&lt;第一个记录集的编号是0&gt;<br>select * from students order by id limit 9,10;</p>
<p>13、MySQL不支持的功能<br>事务，视图，外键和引用完整性，存储过程和触发器</p>
<p>14、MySQL会使用索引的操作符号<br>&lt;,&lt;=,&gt;=,&gt;,=,between,in,不带%或者_开头的like</p>
<p>15、使用索引的缺点<br>1)减慢增删改数据的速度；<br>2）占用磁盘空间；<br>3）增加查询优化器的负担；<br>当查询优化器生成执行计划时，会考虑索引，太多的索引会给查询优化器增加工作量，导致无法选择最优的查询方案；</p>
<p>16、分析索引效率<br>方法：在一般的SQL语句前加上explain；<br>分析结果的含义：<br>1）table：表名；<br>2）type：连接的类型，(ALL/Range/Ref)。其中ref是最理想的；<br>3）possible_keys：查询可以利用的索引名；<br>4）key：实际使用的索引；<br>5）key_len：索引中被使用部分的长度（字节）；<br>6）ref：显示列名字或者”const”（不明白什么意思）；<br>7）rows：显示MySQL认为在找到正确结果之前必须扫描的行数；<br>8）extra：MySQL的建议；</p>
<p>17、使用较短的定长列<br>1）尽可能使用较短的数据类型；<br>2）尽可能使用定长数据类型；<br>a）用char代替varchar，固定长度的数据处理比变长的快些；<br>b）对于频繁修改的表，磁盘容易形成碎片，从而影响数据库的整体性能；<br>c）万一出现数据表崩溃，使用固定长度数据行的表更容易重新构造。使用固定长度的数据行，每个记录的开始位置都是固定记录长度的倍数，可以很容易被检测到，但是使用可变长度的数据行就不一定了；<br>d）对于MyISAM类型的数据表，虽然转换成固定长度的数据列可以提高性能，但是占据的空间也大；</p>
<p>18、使用not null和enum<br>尽量将列定义为not null，这样可使数据的出来更快，所需的空间更少，而且在查询时，MySQL不需要检查是否存在特例，即null值，从而优化查询；<br>如果一列只含有有限数目的特定值，如性别，是否有效或者入学年份等，在这种情况下应该考虑将其转换为enum列的值，MySQL处理的更快，因为所有的enum值在系统内都是以标识数值来表示的；</p>
<p>19、使用optimize table<br>对于经常修改的表，容易产生碎片，使在查询数据库时必须读取更多的磁盘块，降低查询性能。具有可变长的表都存在磁盘碎片问题，这个问题对blob数据类型更为突出，因为其尺寸变化非常大。可以通过使用optimize table来整理碎片，保证数据库性能不下降，优化那些受碎片影响的数据表。 optimize table可以用于MyISAM和BDB类型的数据表。实际上任何碎片整理方法都是用mysqldump来转存数据表，然后使用转存后的文件并重新建数据表；</p>
<p>20、使用procedure analyse()<br>可以使用procedure analyse()显示最佳类型的建议，使用很简单，在select语句后面加上procedure analyse()就可以了；例如：<br>select <em> from students procedure analyse();<br>select </em> from students procedure analyse(16,256);<br>第二条语句要求procedure analyse()不要建议含有多于16个值，或者含有多于256字节的enum类型，如果没有限制，输出可能会很长；</p>
<p>21、使用查询缓存<br>1）查询缓存的工作方式：<br>第一次执行某条select语句时，服务器记住该查询的文本内容和查询结果，存储在缓存中，下次碰到这个语句时，直接从缓存中返回结果；当更新数据表后，该数据表的任何缓存查询都变成无效的，并且会被丢弃。<br>2）配置缓存参数：<br>变量：query_cache _type，查询缓存的操作模式。有3中模式，0：不缓存；1：缓存查询，除非与 select sql_no_cache开头；2：根据需要只缓存那些以select sql_cache开头的查询； query_cache_size：设置查询缓存的最大结果集的大小，比这个值大的不会被缓存。</p>
<p>22、调整硬件<br>1）在机器上装更多的内存；<br>2）增加更快的硬盘以减少I/O等待时间；<br>寻道时间是决定性能的主要因素，逐字地移动磁头是最慢的，一旦磁头定位，从磁道读则很快；<br>3）在不同的物理硬盘设备上重新分配磁盘活动；<br>如果可能，应将最繁忙的数据库存放在不同的物理设备上，这跟使用同一物理设备的不同分区是不同的，因为它们将争用相同的物理资源（磁头）。</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/02/19/操作命令/">
    <time datetime="2019-02-19T08:37:32.000Z" class="entry-date">
        2019-02-19
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爬虫/">爬虫</a></li></ul>

    </footer>
</article>






  
    <article id="post-flask项目部署" class="post-flask项目部署 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/02/16/flask项目部署/">flask项目部署</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/02/16/flask项目部署/" data-id="cjsk5l57b000wl8vep94ayoug" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>通过nohup挂载上去：</p>
<p>1.安装项目文件：先在home下面的src文件夹下面，通过xftp6把本地项目文件放在服务器的src文件下面<br>或者在代码托管平台下载代码 git pull 地址</p>
<p>2.安装虚拟环境：先进入home文件夹下面，然后进入文件env文件夹<br>virtualenv –no-site-packages -p /usr/local/python3/bin/python3 ajenv<br>3.下载环境需要的安装包<br>/home/env/ajenv/bin/pip3 install -r /home/src/aj/requirement.txt<br>4.在虚拟环境下运行manage.py<br>/home/env/ajenv/bin/python3 /home/src/aj/manage.py runserver -p 8080 -h 0.0.0.0<br>5.可以在浏览器中进入项目<br>netstat -lntp 查看端口的状态<br>创建一个文件：touch aj_start.sh<br>修改文件的内容为：/home/env/ajenv/bin/python3 /home/src/aj/manage.py runserver -p 8080 -h 0.0.0.0<br>6.杀掉相应的端口<br>给文件权限<br>method -R 777 aj_start.sh<br>7.挂载项目到后台：<br>nohup ./aj_start.sh &amp;<br>8.在浏览器中访问 39.96.18.59:8080/user/login/(但是现在没有传数据库，暂时不能从数据库中获取信息)<br>也可以在后台挂载</p>
<p>通过nginx+uwsgi挂载aj项目<br>9.看一下是否配置好了文件<br>vim /etc/nginx/nginx.conf<br>在命令行输入set number 看上你第37行是否配置了.conf结尾的文件</p>
<p>10.进入conf文件夹下面<br>cd /home/conf/<br>创建文件夹<br>touch ajnginx.conf</p>
<p>11.编辑文件：<br>配置nginx中的文件</p>
<p>vim ajnginx.conf</p>
<p>在文件里面修改文件</p>
<p>server {<br>    listen 8080;<br>    server_name 39.96.18.59;</p>
<pre><code>access_log /home/logs/ajaccess.log;
error_log /home/logs/ajerror.log;

location / {
    include uwsgi_params;
    uwsgi_pass 127.0.0.1:8099;

    uwsgi_param UWSGI_CHDIR /home/src/aj;
    uwsgi_param UWSGI_SCRIPT manage:app;



}
</code></pre><p>}</p>
<p>12.配置uwsgi文件：<br>创建文件夹<br>touch ajuwsgi.ini<br>编辑文件：<br>vim ajuwsgi.ini</p>
<p>[uwsgi]<br>master = true<br>socket = 127.0.0.1:8099<br>chdir = /home/src/aj<br>pythonpath = /home/env/ajenv/bin/python3<br>callable = app<br>logto = /home/logs/ajuwsgi.log</p>
<p>13.启动nginx<br>systemctl restart nginx<br>(如果出现错误，就需要systemctl status nginx查看状态，里面有出错的原因和位置)</p>
<p>14.安装uwsgi<br>/home/env/ajenv/bin/pip3 install uwsgi</p>
<p>15.启动命令：<br>/home/env/ajenv/bin/uwsgi –ini /home/conf/ajuwsgi.ini &amp;</p>
<p>16.可以访问地址了</p>
<p>17.如果启动出现问题，可以看文件：<br>cd /home/logs/<br>tail -f ajuwsgi.log</p>
<p>可看到日志文件的最新内容</p>
<p>18.数据库的配置和传输：<br>在数据库中本地数据库 结构同步到 服务器上相应的数据库<br>如果不行，可以数据传输</p>
<p>19.解析路由：<br>cd /home/src/<br>cd aj<br>vim app/house_views.py<br>退出</p>
<p>vim manage.py<br>添加路由：<br>from flask import render_template<br>@app.route(‘/‘)<br>def index():<br>    return render_template(‘index.html’)</p>
<p>20.再通过ngnix启动uwsgi<br>/home/env/ajenv/bin/uwsgi –ini /home/conf/ajuwsgi.ini &amp;</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/02/16/flask项目部署/">
    <time datetime="2019-02-16T01:20:25.000Z" class="entry-date">
        2019-02-16
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask框架/">flask框架</a></li></ul>

    </footer>
</article>






  
    <article id="post-django项目部署" class="post-django项目部署 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/02/15/django项目部署/">django项目部署</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/02/15/django项目部署/" data-id="cjsk5l578000ul8vexktg5zjs" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="项目流程"><a href="#项目流程" class="headerlink" title="项目流程"></a>项目流程</h3><p>项目从0到1的过程需要产品、测试、前端、后端、运维共同维护，如下展示项目的设计流程:</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1fzaxjqllhxj30u0143abn.jpg" alt=""></p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1fzaxizzr70j30kg0h2n1i.jpg" alt=""></p>
<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><p>前面有文章，不再赘述</p>
<p>1.在云服务器中设置安全组开启3306端口</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzaugaz1jij30gi0glglx.jpg" alt="安全组"></p>
<p>2.在数据库中将本地数据库的数据传输到阿里云数据库中</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1fzav0gotdxj30r40iu0ui.jpg" alt=""></p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzav2387zvj30pg0iuq3z.jpg" alt=""></p>
<p>再通过Xftp软件将代码传到云服务器上</p>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hgy1fzav4q6229j30pl0k2ag3.jpg" alt=""></p>
<p>将左边代码文件夹拖到右边/home/src目录下即可</p>
<h3 id="安装python3-6"><a href="#安装python3-6" class="headerlink" title="安装python3.6"></a>安装python3.6</h3><p>在centos中，系统默认只提供python2.7的版本，但是项目我们使用的python3.6的版本。所有我们自己安装python3</p>
<h4 id="安装Python3的方法"><a href="#安装Python3的方法" class="headerlink" title="安装Python3的方法"></a>安装Python3的方法</h4><p>首先安装依赖包</p>
<p>安装Python3.6所需要的依赖包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y groupinstall &quot;Development tools&quot;</span><br><span class="line"></span><br><span class="line">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br></pre></td></tr></table></figure>
<p>安装Python3.7还需额外安装依赖包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libffi-devel -y</span><br></pre></td></tr></table></figure>
<p>然后根据自己需求下载不同版本的Python3，我下载的是Python3.6.2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tar.xz</span><br><span class="line"></span><br><span class="line">然后解压压缩包，进入该目录，安装Python3</span><br><span class="line"></span><br><span class="line">tar -xvJf  Python-3.6.2.tar.xz</span><br><span class="line"></span><br><span class="line">cd Python-3.6.2</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/python3</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>最后创建软链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/python3/bin/python3 /usr/bin/python3</span><br><span class="line"></span><br><span class="line">ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3</span><br></pre></td></tr></table></figure>
<h3 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h3><h4 id="1-安装virtualenv"><a href="#1-安装virtualenv" class="headerlink" title="1. 安装virtualenv"></a>1. 安装virtualenv</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install python-virtualenv</span><br></pre></td></tr></table></figure>
<h4 id="2-创建虚拟环境"><a href="#2-创建虚拟环境" class="headerlink" title="2. 创建虚拟环境"></a>2. 创建虚拟环境</h4><p>在根目录下的home中创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /home</span><br><span class="line"># 创建四个文件目录（env中为环境目录，src为代码目录）</span><br><span class="line">mkdir conf env src log</span><br><span class="line">cd env</span><br><span class="line"># 在env中创建环境freshenv</span><br><span class="line">virtualenv --no-site-packages -p /usr/local/python3/bin/python3 freshenv</span><br><span class="line"># 安装项目所需要的库</span><br><span class="line">/home/env/freshenv/bin/pip3 install -r /home/src/fresh_shop/requirement.txt</span><br></pre></td></tr></table></figure>
<h3 id="1-在测试环境中部署方式"><a href="#1-在测试环境中部署方式" class="headerlink" title="1. 在测试环境中部署方式"></a>1. 在测试环境中部署方式</h3><h4 id="1-1-home-src-fresh-shop-settings-py中修改"><a href="#1-1-home-src-fresh-shop-settings-py中修改" class="headerlink" title="1.1 /home/src/fresh_shop/settings.py中修改"></a>1.1 /home/src/fresh_shop/settings.py中修改</h4><p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzavjcbzgsj30md03zglh.jpg" alt=""></p>
<h4 id="1-2-home-src-fresh-shop-urls-py"><a href="#1-2-home-src-fresh-shop-urls-py" class="headerlink" title="1.2 /home/src/fresh_shop/urls.py"></a>1.2 /home/src/fresh_shop/urls.py</h4><p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzavlqwk1xj30p60dvjri.jpg" alt=""></p>
<h4 id="1-3-home-src-resh-shop-utils-middleware-py"><a href="#1-3-home-src-resh-shop-utils-middleware-py" class="headerlink" title="1.3 /home/src/resh_shop/utils/middleware.py"></a>1.3 /home/src/resh_shop/utils/middleware.py</h4><p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzavmigoo0j30oz0dgdg6.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 在/home/src/中创建freshshop.sh</span><br><span class="line">touch freshshop.sh</span><br><span class="line"># 在freshop.sh中写入启动命令（/home/env/freshenv/bin/python3 /home/src/fresh_shop/manage.py runserver 0.0.0.0:80</span><br><span class="line">）</span><br><span class="line">vim freshop.sh</span><br><span class="line"># 修改freshshop.sh的权限</span><br><span class="line">chmod -R 777 freshshop.sh</span><br><span class="line"># 启动服务器</span><br><span class="line">nohup ./freshshop.sh &amp;</span><br><span class="line"># src下面会自动生成nohup.out,请求都会写在里面</span><br></pre></td></tr></table></figure>
<h3 id="2-正式环境中部署方式"><a href="#2-正式环境中部署方式" class="headerlink" title="2. 正式环境中部署方式"></a>2. 正式环境中部署方式</h3><p>正式环境中部署为nginx+uwsgi来部署django项目</p>
<h4 id="2-1-安装nginx"><a href="#2-1-安装nginx" class="headerlink" title="2.1 安装nginx"></a>2.1 安装nginx</h4><p>a）添加nginx存储库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure>
<p>b) 安装nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx</span><br></pre></td></tr></table></figure>
<p>c) 运行nginx</p>
<p>Nginx不会自行启动。要运行Nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure>
<p>nginx的运行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx 查看nginx的状态</span><br><span class="line">systemctl start/stop/enable/disable nginx 启动/关闭/设置开机启动/禁止开机启动</span><br></pre></td></tr></table></figure>
<p>d）系统启动时启用Nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>
<p>e）如果您正在运行防火墙，请运行以下命令以允许HTTP和HTTPS通信：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --zone=public --add-service=http </span><br><span class="line"></span><br><span class="line">sudo firewall-cmd --permanent --zone=public --add-service=https</span><br><span class="line"></span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h4 id="3-配置uwsgi"><a href="#3-配置uwsgi" class="headerlink" title="3.配置uwsgi"></a>3.配置uwsgi</h4><h5 id="3-1-安装uwsgi"><a href="#3-1-安装uwsgi" class="headerlink" title="3.1 安装uwsgi"></a>3.1 安装uwsgi</h5><p>在虚拟环境中安装uwsgi，假设虚拟环境安装在/home/env/freshenv中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/env/freshenv/bin/pip install uwsgi</span><br></pre></td></tr></table></figure>
<h4 id="4-配置项目代码，配置项目nginx，配置uwsgi-ini等"><a href="#4-配置项目代码，配置项目nginx，配置uwsgi-ini等" class="headerlink" title="4. 配置项目代码，配置项目nginx，配置uwsgi.ini等"></a>4. 配置项目代码，配置项目nginx，配置uwsgi.ini等</h4><p>本案例的配置文件，都习惯将每一个项目的配置文件，日志文件，虚拟环境放在一起，这样开发方便，运维也方便维护</p>
<p>项目的目录结构如下：</p>
<p>[<img src="https://ww1.sinaimg.cn/large/007rAy9hgy1fzaw7wpc6mj30h80353yi.jpg" alt="图"></p>
<p>其中：</p>
<p>conf是配置文件，用于存放项目的nginx.conf文件，uwsgi.ini文件</p>
<p>logs是日志文件，用于存放nginx的启动成功和失败文件，以及uwsgi的运行日志文件</p>
<p>env是用于存放虚拟环境</p>
<p>src是项目文件，该目录下上传的是目录代码</p>
<p>在conf中创建两个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch freshnginx.conf</span><br><span class="line">touch freshuwsgi.ini</span><br></pre></td></tr></table></figure>
<h4 id="4-1-配置nginx-conf文件"><a href="#4-1-配置nginx-conf文件" class="headerlink" title="4.1 配置nginx.conf文件"></a>4.1 配置nginx.conf文件</h4><p><strong>首先</strong>：编写自己项目的nginx.conf文件如下：</p>
<p>每一个项目对应有一个自己定义的nginx的配置文件，我定义为freshnginx.conf文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 1 server&#123;</span><br><span class="line"> 2     listen  80;</span><br><span class="line"> 3     server_name 39.108.58.209;</span><br><span class="line"> 4     access_log /home/logs/freshaccess.log;</span><br><span class="line"> 5     error_log /home/logs/fresherror.log;</span><br><span class="line"> 6 </span><br><span class="line"> 7     location / &#123;</span><br><span class="line"> 8         include uwsgi_params;</span><br><span class="line"> 9         uwsgi_pass 127.0.0.1:8890;</span><br><span class="line">10 &#125;</span><br><span class="line">11 </span><br><span class="line">12     location /static/ &#123;</span><br><span class="line">13         alias /home/src/fresh_shop/static/;</span><br><span class="line">14 &#125;</span><br><span class="line">15 </span><br><span class="line">16     location /media/ &#123;</span><br><span class="line">17         alias /home/src/fresh_shop/media/;</span><br><span class="line">18     &#125;</span><br><span class="line">19 &#125;</span><br></pre></td></tr></table></figure>
<p><strong>其次</strong>：修改总的nginx的配置文件，让总的nginx文件包含我们自定义的项目的freshnginx.conf文件</p>
<p>总的nginx配置文件在：/etc/nginx/nginx.conf中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzawhp0rncj30hc0awmxq.jpg" alt=""></p>
<p>以上步骤操作完成以后，需要重启nginx：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>
<p>如果自定义的axfnginx.conf文件没有错误的话，查看nginx的运行状态会有如下的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/007rAy9hly1fzawkx4grcj30hh0augmf.jpg" alt=""></p>
<h4 id="4-2-配置uwsgi文件"><a href="#4-2-配置uwsgi文件" class="headerlink" title="4.2 配置uwsgi文件"></a>4.2 配置uwsgi文件</h4><p>在conf文件夹下除了包含自定义的freshnginx.conf文件，还有我们定义的freshuwsgi.ini文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1 [uwsgi]</span><br><span class="line"># 守护进程</span><br><span class="line">2 master = true</span><br><span class="line"># 进程个数</span><br><span class="line">3 processes = 4</span><br><span class="line"># 项目地址</span><br><span class="line">4 chdir = /home/src/fresh_shop</span><br><span class="line"># 指定python版本</span><br><span class="line">5 pythonpath = /home/env/freshenv/bin/python3</span><br><span class="line"># 指定uwsgi文件</span><br><span class="line">6 module = fresh_shop.wsgi</span><br><span class="line"># 和nginx通信地址:端口</span><br><span class="line">7 socket = 127.0.0.1:8890</span><br><span class="line"># 日志文件地址</span><br><span class="line">8 logto = /home/logs/freshuwsgi.log</span><br></pre></td></tr></table></figure>
<p>运行项目:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br><span class="line">/home/env/freshenv/bin/uwsgi --ini /home/conf/freshuwsgi.ini</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Linux文件颜色代表含义：</span><br><span class="line">蓝色表示目录</span><br><span class="line">绿色表示可执行文件</span><br><span class="line">红色表示压缩文件</span><br><span class="line">浅蓝色表示链接文件</span><br><span class="line">白色表示其他文件</span><br><span class="line">黄色是设备文件，包括block, char, fifo</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 更改权限</span><br><span class="line">chmod -R 777 freshshop.sh</span><br><span class="line">查看nginx状态</span><br><span class="line">systemctl status nginx</span><br><span class="line"># 删除文件</span><br><span class="line">rm -rf filename</span><br><span class="line"># 查看端口</span><br><span class="line">netstat -lntp</span><br><span class="line"># 强制关闭端口号</span><br><span class="line">kill -9 端口号 </span><br><span class="line"># 查看文件（直接到结尾，会实时更新，cat不会）</span><br><span class="line">tail -f freshuwsgi.log</span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/02/15/django项目部署/">
    <time datetime="2019-02-15T07:02:09.000Z" class="entry-date">
        2019-02-15
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/框架/">框架</a></li></ul>

    </footer>
</article>






  
    <article id="post-day-04flask数据库、分页、文件上传" class="post-day-04flask数据库、分页、文件上传 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/24/day-04flask数据库、分页、文件上传/">day_04flask数据库、分页、文件上传</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/24/day-04flask数据库、分页、文件上传/" data-id="cjsk5l56x000nl8vedciwmltv" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h3 id="day-04"><a href="#day-04" class="headerlink" title="day_04 ==================================================="></a>day_04 ===================================================</h3><p><img src="/images/QQ截图20190124172218.png" alt=""><br><img src="/images/QQ截图20190124172246.png" alt=""></p>
<pre><code># 且 and_ : 默认就是且的操作，可不写
stus = Student.query.filter(and_(Student.s_name.contains(&apos;哥&apos;),
                            Student.s_age &gt; 22)).all()
# 或 or_
stus = Student.query.filter(or_(Student.s_name.contains(&apos;哥&apos;),
                            Student.s_age &gt; 22)).all()
# 非 not_
stus = Student.query.filter(not_(Student.s_name.contains(&apos;哥&apos;)), Student.s_age &gt; 22).all()
print(stus)

return &apos;查询成功&apos;
</code></pre><h3 id="分页操作———————"><a href="#分页操作———————" class="headerlink" title="分页操作———————"></a>分页操作———————</h3><p><img src="/images/QQ截图20190124172159.png" alt=""><br>@blue.route(‘/all_stu/‘, methods=[‘GET’])<br>def all_stu():<br>    if request.method == ‘GET’:<br>        page = int(request.args.get(‘page’, 1)) # (‘page’, 1) page获取页码，如果没写，默认为第1页<br>        pg = Student.query.paginate(page, 5) # paginate(n, m)第n页 每页m条数据</p>
<pre><code># 获取当页的数据
stus = pg.items
return render_template(&apos;stus.html&apos;, stus=stus, pg=pg)
</code></pre><h3 id="一对多———————"><a href="#一对多———————" class="headerlink" title="一对多———————-"></a>一对多———————-</h3><p>@blue.route(‘/add_grade/‘, methods=[‘GET’])<br>def add_grade():<br>    if request.method == ‘GET’:<br>        gnames = [‘Python’, ‘Java’, ‘Php’, ‘C++’, ‘C’]<br>        for name in gnames:<br>            g = Grade()<br>            g.g_name = name<br>            db.session.add(g)<br>        db.session.commit()</p>
<pre><code>return &apos;创建班级信息成功&apos;
</code></pre><p>@blue.route(‘/create_stu_grade/‘, methods=[‘GET’])<br>def create_stu_grade():<br>    if request.method == ‘GET’:</p>
<pre><code># 获取id为1和2的学生
stu1 = Student.query.get(1)
stu2 = Student.query.get(3)
# 分配给python班级
g = Grade.query.filter(Grade.g_name==&apos;Python&apos;).first()
stu1.g_id = g.id
stu1.save()

stu2.g_id = g.id
stu2.save()

return &apos;分配学生成功&apos;
</code></pre><p>@blue.route(‘/sel_stu_by_grade/‘, methods=[‘GET’])<br>def sel_stu_by_grade():<br>    if request.method == ‘GET’:<br>        grade = Grade.query.filter_by(g_name=’Python’).first()</p>
<pre><code># 通过班级查学生
stus = grade.s_g
stus_name = [stu.s_name for stu in stus]
return &apos;改班级下的学生姓名为：%s&apos; %stus_name
</code></pre><p>@blue.route(‘/stu_grade_by_stu/‘, methods=[‘GET’])<br>def stu_grade_by_stu():<br>    if request.method == ‘GET’:<br>        stu = Student.query.filter(Student.s_name==’张三’).first()</p>
<pre><code># 通过学生查班级
grade = stu.g
return &apos;张三属于%s班级&apos; % grade.g_name
</code></pre><h3 id="多对多—————————–"><a href="#多对多—————————–" class="headerlink" title="多对多—————————–"></a>多对多—————————–</h3><h3 id="添加课程"><a href="#添加课程" class="headerlink" title="添加课程"></a>添加课程</h3><p>@blue.route(‘/add_cou/‘, methods=[‘GET’])<br>def add_cou():<br>    if request.method == ‘GET’:<br>        cou_names = [‘语文’, ‘数学’, ‘英语’, ‘物理’, ‘生物’, ‘地理’, ‘政治’, ‘化学’]<br>        c = []<br>        for name in cou_names:<br>            cou = Course()<br>            cou.c_name = name<br>            c.append(cou)<br>        db.session.add_all(c)<br>        db.session.commit()<br>        return ‘添加成功’</p>
<h3 id="中间表添加数据"><a href="#中间表添加数据" class="headerlink" title="中间表添加数据"></a>中间表添加数据</h3><p>@blue.route(‘/stu_cou/‘, methods=[‘GET’])<br>def stu_cou():<br>    if request.method == ‘GET’:</p>
<pre><code># 给小明添加英语和物理
stu = Student.query.filter(Student.s_name==&apos;张三&apos;).first()
stu1 = Student.query.filter(Student.s_name==&apos;李四&apos;).first()
cou1 = Course.query.filter(Course.c_name==&apos;英语&apos;).first()
cou2 = Course.query.filter(Course.c_name==&apos;物理&apos;).first()
# 添加      stu.cou 是一个[]
# stu.cou.append(cou1)
# stu.cou.append(cou2)   # django里面: cou.stu.add(stu)
# cou1.stu.append(stu1)
# 删除
stu.cou.remove(cou1)
db.session.commit()

return &apos;添加学生课程成功&apos;
</code></pre><h3 id="圖片上傳"><a href="#圖片上傳" class="headerlink" title="圖片上傳"></a>圖片上傳</h3><p><img src="/images/QQ截图20190124172058.png" alt=""><br><img src="/images/QQ截图20190124172135.png" alt=""><br>@blue.route(‘/edit_stu/<a href="int:id" target="_blank" rel="noopener">int:id</a>/‘, methods=[‘GET’, ‘POST’])<br>def edit_stu(id):<br>    if request.method == ‘GET’:<br>        stu = Student.query.get(id)<br>        return render_template(‘edit.html’, stu=stu)<br>    if request.method == ‘POST’:</p>
<pre><code># 接收图片并保存图片
icon = request.files.get(&apos;image&apos;)
# 获取项目根路径
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
# 获取媒体文件的路径
STSTIC_DIR = os.path.join(BASE_DIR, &apos;static&apos;)
MEDIA_DIR = os.path.join(STSTIC_DIR, &apos;media&apos;)
# 随机生成图片名称
filename = str(uuid.uuid4())
a = icon.mimetype.split(&apos;/&apos;)[-1:][0]
name = filename + &apos;.&apos; + a
# 拼接图片地址
path = os.path.join(MEDIA_DIR, name)
icon.save(path)
# print(icon)
# 修改用户头像icon字段
stu = Student.query.get(id)
stu.icon = name
stu.save()
# 重定向到列表页面

return redirect(url_for(&apos;app.all_stu&apos;))
</code></pre><p>####go语言资料<br><img src="/images/QQ截图20190124171017.png" alt=""></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/24/day-04flask数据库、分页、文件上传/">
    <time datetime="2019-01-24T09:13:30.000Z" class="entry-date">
        2019-01-24
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask框架/">flask框架</a></li></ul>

    </footer>
</article>






  
    <article id="post-day03flask框架（增、删、改、查）" class="post-day03flask框架（增、删、改、查） post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/23/day03flask框架（增、删、改、查）/">day03flask框架（增、删、改、查）</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/23/day03flask框架（增、删、改、查）/" data-id="cjsk5l58d001ml8vev1ip8dbj" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="flask框架"><a href="#flask框架" class="headerlink" title="flask框架"></a>flask框架</h1><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="安装：pip-install-flask-sqlalchemy"><a href="#安装：pip-install-flask-sqlalchemy" class="headerlink" title="安装：pip install flask-sqlalchemy"></a>安装：pip install flask-sqlalchemy</h3><h3 id="创建对象：-from-flask-sqlalchemy-import-SQLALCheny-db-SQLCheny-40-41"><a href="#创建对象：-from-flask-sqlalchemy-import-SQLALCheny-db-SQLCheny-40-41" class="headerlink" title="创建对象：  from flask_sqlalchemy import SQLALCheny        db = SQLCheny&#40;&#41;"></a>创建对象：  from flask_sqlalchemy import SQLALCheny        db = SQLCheny&#40;&#41;</h3><h3 id="模型定义："><a href="#模型定义：" class="headerlink" title="模型定义："></a>模型定义：</h3><p>class User&#40;db.Model, UserMixin&#41;:</p>
<pre><code># 定义自增的主键id
id = db.Column(db.Integer, primary_key=True, autoincrement=True)
# 定义长度为10的name字段，唯一 且 不能为空
name = db.Column(db.String(10), unique=True, nullable=False)
# 定义密码，不能为空
password = db.Column(db.String(249), nullable=False)
# 定义数据库表名
__tablename__ = &apos;flask_user&apos;
</code></pre><h3 id="配置连接：-flask对象-config-‘SQLALCHEMY-DATABASE-URI’-’mysql-pymysql-root-123456-127-0-0-1-3306-flask8’"><a href="#配置连接：-flask对象-config-‘SQLALCHEMY-DATABASE-URI’-’mysql-pymysql-root-123456-127-0-0-1-3306-flask8’" class="headerlink" title="配置连接：   flask对象.config[‘SQLALCHEMY_DATABASE_URI’]=’mysql+pymysql://root:123456@127.0.0.1:3306/flask8’"></a>配置连接：   flask对象.config[‘SQLALCHEMY_DATABASE_URI’]=’mysql+pymysql://root:<a href="mailto:123456@127.0.0.1" target="_blank" rel="noopener">123456@127.0.0.1</a>:3306/flask8’</h3><h3 id="初始化：db-init-app-40-flask对象-41"><a href="#初始化：db-init-app-40-flask对象-41" class="headerlink" title="初始化：db.init_app&#40;flask对象&#41;"></a>初始化：db.init_app&#40;flask对象&#41;</h3><h3 id="模型的映射"><a href="#模型的映射" class="headerlink" title="模型的映射"></a>模型的映射</h3><ul>
<li>创建：db.create_all&#40;&#41;</li>
<li>删除:db.drop_all&#40;&#41;</li>
</ul>
<p>###模板数据库响应（相当于django的迁移）<br><img src="/images/QQ截图20190123144033.png" alt=""></p>
<h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><ul>
<li>add&#40;对象&#41;</li>
<li>add_all&#40;[对象1，对象2，对象3 . . .]&#41;</li>
<li>使用：db.session.add&#40;对象&#41;<br> db.session.add_all&#40;[对象1，对象2，对象3 . . .]&#41;</li>
</ul>
<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><ul>
<li>delete&#40;对象&#41;</li>
<li>使用：db.session.delete&#40;stu&#41;   db.session.commit&#40;&#41;</li>
</ul>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><ul>
<li>使用：db.session.add&#40;对象&#41;    db.session.commit&#40;&#41;</li>
<li>注意：add&#40;对象&#41;这个方法可不写</li>
</ul>
<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><h1 id="查-1"><a href="#查-1" class="headerlink" title="查"></a>查</h1><p>@blue.route&#40;’/sel_stu/‘, methods=[‘GET’]&#41;<br>def sel_stu&#40;&#41;:<br>    if request.method == ‘GET’:</p>
<pre><code># stu = Student.query.filter(Student.s_name==&apos;张三&apos;)
stu = Student.query.filter_by(s_name=&apos;张三&apos;)

# 获取第一个对象
# 在django中查询第一个Student.objects.all().first()
stu = Student.query.all()[0]
stu = Student.query.first()

# get()方法
# 获取主键所在行的对象信息
# get方法，能获取到对象则返回，获取不到对象则为none
stu = Student.query.get(3)            # 默认id=2
stu = Student.query.filter_by(id=3).first() # 三个一样的效果
stu = Student.query.filter(Student.id==3).first()
print(stu)

return &apos;查询成功&apos;
</code></pre><ul>
<li><p>filter（模型名.字段 == 值）</p>
<p>stu = Student.query.filter&#40;Student.id==3&#41;.first&#40;&#41;</p>
</li>
<li><p>filter_by（字段 = 值）</p>
<p>stu = Student.query.filter_by&#40;id=3&#41;.first&#40;&#41;</p>
</li>
<li><p>all&#40;&#41;:查询所有的数据，结果为列表</p>
<p>stu = Student.query.all&#40;&#41;[0]</p>
</li>
<li><p>first&#40;&#41;：查询filter或者filter_by结果中的第一个元素</p>
</li>
<li><p>get&#40;id值&#41;：获取主键所在行的对象，获取不到也不会报错，返回none</p>
<p>stu = Student.query.get&#40;3&#41;            # 默认id=2</p>
</li>
<li><p>order_by&#40;&#41;：排序</p>
</li>
<li><p>order_by&#40;’-id’&#41;：表示按照id的降序排列</p>
</li>
<li><p>order_by&#40;’id’&#41;：表示按照id的升序排列</p>
</li>
<li><p>offset&#40;数值1&#41;.limit&#40;数值2&#41;：表示跳过几个参数（数值1），再截取几个参数（数值2）</p>
<p>page = 1</p>
<pre><code>stus = Student.query.offset((page-1) * 3).limit(3).all()
print(stus)
</code></pre></li>
<li><p>大小于</p>
<p>gt大于, ge大约等于, lt小于, le小于等于;  同时&#40;&gt;, &gt;=, &lt;, &lt;= 也能识别&#41;</p>
<pre><code>stus = Student.query.filter(Student.s_age.__gt__(30)).all()  # 查询大于30的学生
stus = Student.query.filter(Student.s_age &lt;= 30).all()
print(stus)
</code></pre><ul>
<li>gt / &gt;：大于</li>
<li>ge / &gt;+ ：大于等于</li>
<li>lt / &lt; ：小于 </li>
<li>le / &lt;= ：小于等于</li>
</ul>
</li>
<li><p>模糊</p>
<p>模糊查询， like % _</p>
<pre><code>stus = Student.query.filter(Student.s_name.contains(&apos;隔壁&apos;)).all()
print(stus)   # contains(&apos;隔壁&apos;)  模糊查询
stus = Student.query.filter(Student.s_name.startswith(&apos;张&apos;)).all()
print(stus)   # startswith(&apos;张&apos;)  查询 &apos;张&apos; 开头的数据
stus = Student.query.filter(Student.s_name.endswith(&apos;四&apos;)).all()
print(stus)   # endswith(&apos;四&apos;)    查询 &apos;四&apos; 结尾的数据
stus = Student.query.filter(Student.s_name.like(&apos;__老%&apos;)).all()
print(stus)   # like(&apos;__老%&apos;)     查询第三位是 &apos;老&apos; 的数据
</code></pre><ul>
<li><p>contains：包含</p>
<p>stus = Student.query.filter&#40;Student.s_name.contains&#40;’隔壁’&#41;&#41;.all&#40;&#41;</p>
<pre><code>print(stus)   # contains(&apos;隔壁&apos;)  模糊查询
</code></pre></li>
<li><p>startswith&#40;&#41;：以什么开头</p>
<p>stus = Student.query.filter&#40;Student.s_name.startswith&#40;’张’&#41;&#41;.all&#40;&#41;</p>
<pre><code>print(stus)   # startswith(&apos;张&apos;)  查询 &apos;张&apos; 开头的数据
</code></pre></li>
<li><p>endswith：以什么结束</p>
<p>stus = Student.query.filter&#40;Student.s_name.endswith&#40;’四’&#41;&#41;.all&#40;&#41;</p>
<pre><code>print(stus)   # endswith(&apos;四&apos;)    查询 &apos;四&apos; 结尾的数据
</code></pre></li>
<li><p>like&#40;&#41;：模糊查询</p>
<p>stus = Student.query.filter&#40;Student.s_name.like&#40;’__老%’&#41;&#41;.all&#40;&#41;</p>
<pre><code>print(stus)   # like(&apos;__老%&apos;)     查询第三位是 &apos;老&apos; 的数据
</code></pre><ul>
<li>% ：表示匹配任何长度的字符</li>
<li>_ ：表示匹配一个占位</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>第一访问任何一个路由地址时，在客户端，将在cookie中存储一个键值对，键为session，值为唯一的uuid类型的参数</li>
<li>第一次方式的同时，在服务端指定的redis中，也将存储cookie中的uuid参数中保存信息</li>
<li>如果用户登录成功，则可以像redis中存储的uuid参数保存信息</li>
</ul>
<h3 id="flask自带形式"><a href="#flask自带形式" class="headerlink" title="flask自带形式"></a>flask自带形式</h3><ul>
<li>存储数据：将session中存储的键值对内容存放在cookie中</li>
<li>存储方式：设置secret_key参数，越复杂越好</li>
<li>使用方式：   from flask import session  <pre><code>session[&apos;key&apos;] = value
</code></pre></li>
</ul>
<h3 id="使用flask-session第三方库"><a href="#使用flask-session第三方库" class="headerlink" title="使用flask-session第三方库"></a>使用flask-session第三方库</h3><ul>
<li>安装：pip install flask-session</li>
<li>配置存储的数据库：   flask对象config[‘SESSION_TYPE’] = ‘redis’         flask对象.config[‘SESSION_REDIS’] = redis.Redis&#40;host, port, password&#41;</li>
<li><p>初始化：from flask_session import Session</p>
</li>
<li><p>第一种：Session&#40;flask对象&#41;</p>
</li>
<li>第二种：se = Session&#40;&#41;       se.init_app&#40;flask对象&#41;</li>
</ul>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p>父模板：父模板负责挖坑&#123;% block %&#125;&#123;% endblock %&#125;,挖的坑可以被子模板动态的填充内容</p>
<p>子模板：继承于父模板，并动态填充坑的内容</p>
<ul>
<li>继承&#123;% extnds ‘父模板’ %&#125;</li>
<li>包含：&#123;% inclde ‘摸个文件模板’ %&#125;</li>
<li>获取坑之前填充的内容：&#123;&#123; super&#40;&#41; &#125;&#125;</li>
<li><p>静态文件</p>
</li>
<li><p>硬编码：指定定义静态文件路径</p>
</li>
<li><p>使用url_for进行解析：href=”&#123;&#123; url_for&#40;’static’, filename=’css/index.css’&#41; &#125;&#125;”</p>
</li>
<li><p>注解</p>
</li>
<li><p><!--注解内容-->：注意注解中的内容标签必须定义正确</p>
</li>
<li>&#123;# 单行和多行注解 #&#125;</li>
<li><p>注意：和django的区别，没有comment多行注解标签</p>
</li>
<li><p>标签</p>
</li>
<li><p>if标签：&#123;% if 条件 == 值 %&#125;&#123;% endif %&#125;</p>
</li>
<li>for标签：&#123;% for i in 迭代对象 %&#125;&#123;% else %&#125;&#123;% endfor %&#125;</li>
<li><p>loop</p>
<ul>
<li>获取从1开始增加的编号：&#123;&#123; loop.index &#125;&#125;</li>
<li>获取从0开始增加的编号：&#123;&#123; loop.index0 &#125;&#125;</li>
<li>倒叙到1结束：&#123;&#123; loop.revindex &#125;&#125;`</li>
<li>倒叙到0结束：&#123;&#123; loop.revindex0 &#125;&#125;</li>
<li>判断循环第一次：&#123;&#123; loop.first &#125;&#125;</li>
<li>判断循环最后一次：&#123;&#123; loop.last &#125;&#125;</li>
</ul>
</li>
<li><p>重点：jinja2模板引擎中没有ifequal标签</p>
</li>
<li><p>macro宏定义</p>
<ul>
<li><p>无参情况</p>
</li>
<li><p>&#123;% macro say&#40;&#41; %&#125;<br> </p><h5>今天班上女生好漂亮</h5><br> &#123;% endmacro %&#125;<p></p>
</li>
<li><p>有参情况</p>
</li>
<li><p>&#123;% macro create&#40;name, age&#41; %&#125;<br> </p><h5>登陆系统的用户名为：&#123;&#123; name &#125;&#125;, 年龄：&#123;&#123; age &#125;&#125;</h5><br> &#123;% endmacro %&#125;<p></p>
</li>
<li><p>使用：&#123;&#123; say&#40;&#41; &#125;&#125;</p>
</li>
<li>引入：&#123;% from ‘functions.html’ import say, create %&#125;</li>
</ul>
</li>
</ul>
<p>###flask过滤器 管道符 ‘|’<br>1、add ：将value的值增加2。使用形式为：&#123;&#123; value | add: “2”&#125;&#125;。<br>2、addslashes：在value中的引号前增加反斜线。使用形式为：&#123;&#123; value | addslashes &#125;&#125;。<br>3、capfirst：value的第一个字符转化成大写形式。使用形式为：&#123;&#123; value | capfirst &#125;&#125;。<br>4、cut：从给定value中删除所有arg的值。使用形式为：&#123;&#123; value | cut:arg&#125;&#125;。<br>5、date: 格式化时间格式。使用形式为：&#123;&#123; value | date:”Y-m-d H:i:s” &#125;&#125;<br>6、default：如果value是False，那么输出使用缺省值。使用形式：&#123;&#123; value | default: “nothing” &#125;&#125;。例如，如果value是“”，那么输出将是nothing<br>7、default_if_none：如果value是None，那么输出将使用缺省值。使用形式：&#123;&#123; value | default_if_none:”nothing” &#125;&#125;，例如，如果value是None，那么输出将是nothing<br>8、dictsort：如果value的值是一个字典，那么返回值是按照关键字排序的结果<br>使用形式：&#123;&#123; value | dictsort:”name”&#125;&#125;，例如，<br>如果value是：<br>[&#123;’name’: ‘python’&#125;,&#123;’name’: ‘java’&#125;,&#123;’name’: ‘c++’&#125;,]<br>那么，输出是：<br>[&#123;’name’: ‘c++’&#125;,&#123;’name’: ‘java’&#125;,&#123;’name’: ‘python’&#125;, ]<br>9、dictsortreversed：如果value的值是一个字典，那么返回值是按照关键字排序的结果的反序。使用形式：与dictsort过滤器相同。<br>10、divisibleby：如果value能够被arg整除，那么返回值将是True。使用形式：&#123;&#123; value | divisibleby:arg&#125;&#125;，如果value是9，arg是3，那么输出将是True<br>11、escape：替换value中的某些字符，以适应HTML格式。使用形式：&#123;&#123; value | escape&#125;&#125;。例如，&lt; 转化为 &lt;&gt; 转化为 &gt;’ 转化为  &#39;” 转化为  &quot;<br>13、filesizeformat：格式化value，使其成为易读的文件大小。使用形式：&#123;&#123; value | filesizeformat &#125;&#125;。例如：13KB，4.1MB等。<br>14、first：返回列表/字符串中的第一个元素。使用形式：&#123;&#123; value | first &#125;&#125;<br>16、iriencode：如果value中有非ASCII字符，那么将其进行转化成URL中适合的编码，如果value已经进行过URLENCODE，改操作就不会再起作用。使用形式：&#123;&#123;value | iriencode&#125;&#125;<br>17、join：使用指定的字符串连接一个list，作用如同python的str.join&#40;list&#41;。使用形式：&#123;&#123; value | join:”arg”&#125;&#125;，如果value是[‘a’,’b’,’c’]，arg是’//‘那么输出是a//b//c<br>18、last：返回列表/字符串中的最后一个元素。使用形式：&#123;&#123; value | last &#125;&#125;<br>19、length：返回value的长度。使用形式：&#123;&#123; value | length &#125;&#125;<br>20、length_is：如果value的长度等于arg的时候返回True。使用形式：&#123;&#123; value | length_is:”arg”&#125;&#125;。例如：如果value是[‘a’,’b’,’c’]，arg是3，那么返回True<br>21、linebreaks：value中的”\n”将被<br>替代，并且整个value使用</p>包围起来。使用形式：&#123;&#123;value|linebreaks&#125;&#125;<br>22、linebreaksbr：value中的”\n”将被<br>替代。使用形式：&#123;&#123;value |linebreaksbr&#125;&#125;<br>23、linenumbers：显示的文本，带有行数。使用形式：&#123;&#123;value | linenumbers&#125;&#125;<br>24、ljust：在一个给定宽度的字段中，左对齐显示value。使用形式：&#123;&#123;value | ljust&#125;&#125;<br>25、center：在一个给定宽度的字段中，中心对齐显示value。使用形式：&#123;&#123;value | center&#125;&#125;<br>26、rjust：：在一个给定宽度的字段中，右对齐显示value。使用形式：&#123;&#123;value | rjust&#125;&#125;<br>27、lower：将一个字符串转换成小写形式。使用形式：&#123;&#123;value | lower&#125;&#125;<br>30、random：从给定的list中返回一个任意的Item。使用形式：&#123;&#123;value | random&#125;&#125;<br>31、removetags：删除value中tag1,tag2….的标签。使用形式：&#123;&#123;value | removetags:”tag1 tag2 tag3…”&#125;&#125;<br>32、safe：当系统设置autoescaping打开的时候，该过滤器使得输出不进行escape转换。使用形式：&#123;&#123;value | safe&#125;&#125;<br>33、safeseq：与safe基本相同，但有一点不同的就是：safe是针对字符串，而safeseq是针对多个字符串组成的sequence<br>34、slice：与python语法中的slice相同。使用形式：&#123;&#123;some_list | slice:”2”&#125;&#125;<br>37、striptags：删除value中的所有HTML标签.使用形式：&#123;&#123;value | striptags&#125;&#125;<br>38、time：格式化时间输出。使用形式：&#123;&#123;value | time:”H:i”&#125;&#125;或者&#123;&#123;value | time&#125;&#125;<br>39、title：转换一个字符串成为title格式。<br>40、truncatewords：将value切成truncatewords指定的单词数目。使用形式：&#123;&#123;value | truncatewords:2&#125;&#125;。例如，如果value是Joel is a slug 那么输出将是：Joel is …<br>42、upper：转换一个字符串为大写形式<br>43、urlencode：将一个字符串进行URLEncode<br>44、wordcount：返回字符串中单词的数目<p></p>
<p><em>XMind: ZEN - Trial Version</em># flask框架</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/23/day03flask框架（增、删、改、查）/">
    <time datetime="2019-01-23T11:07:43.000Z" class="entry-date">
        2019-01-23
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask框架/">flask框架</a></li></ul>

    </footer>
</article>






  
    <article id="post-Flask框架脑图day-02" class="post-Flask框架脑图day-02 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/22/Flask框架脑图day-02/">Flask框架脑图day_02</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/22/Flask框架脑图day-02/" data-id="cjsk5l5610004l8ven8t69ohw" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h1><p>hexo发布文章符号报错 处理方法</p>
<p><img src="/images/QQ图片20190122175458.png" alt=""></p>
<h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><p>创建: virtualenv–no-site-packages -p xxxx freshenv8</p>
<p>安装flask: pip install flask</p>
<p>安装文件: pip install -r requirement.txt</p>
<h2 id="Flask最小应用"><a href="#Flask最小应用" class="headerlink" title="Flask最小应用"></a>Flask最小应用</h2><p>最小7行代码</p>
<p>生成flask对象，传入<strong>name</strong>参数，表示模块名或包名</p>
<p>app = Flask&#40;<strong>name</strong>&#41;</p>
<p>告诉服务器，访问127.0.0.1:5000/hello/地址可触发hello&#40;&#41;方法</p>
<p>类似与Django中的urls.py文件的功能</p>
<p>@app.route&#40;’/hello/‘&#41;<br>def hello&#40;&#41;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return &apos;hello world&apos;</span><br></pre></td></tr></table></figure>
<p>sys.argv接收启动命令时的参数，如: python hello.py 0.0.0.0 80</p>
<p>ip = sys.argv[1]<br>port = sys.argv[2]</p>
<p>host代表启动的ip地址</p>
<p>port代表启动的端口</p>
<p>debug代表启动的模式，调试模型</p>
<p>app.run&#40;host=ip, port=port, debug=True&#41;</p>
<h2 id="flask-script"><a href="#flask-script" class="headerlink" title="flask_script"></a>flask_script</h2><p>使用: 用于管理flask启动的命令</p>
<h5 id="安装-pip-install-flask-script"><a href="#安装-pip-install-flask-script" class="headerlink" title="安装: pip install flask_script"></a>安装: pip install flask_script</h5><h3 id="使用"><a href="#使用" class="headerlink" title="使用:"></a>使用:</h3><p>from flask_script import Manager<br>manage = Manager&#40;flask应用&#41;<br>启动: manage.run&#40;&#41;</p>
<p>启动命令: python xxx.py runserver -p 端口 -h IP地址 -d 调试模式</p>
<h2 id="flask-blueprint"><a href="#flask-blueprint" class="headerlink" title="flask-blueprint"></a>flask-blueprint</h2><p>背景: 模块化管理路由地址</p>
<p>安装: pip install flask-blueprint</p>
<h4 id="使用-分两步"><a href="#使用-分两步" class="headerlink" title="使用: 分两步"></a>使用: 分两步</h4><ul>
<li>第一步: 管理路由</li>
<li>初始化: blue = Blueprint&#40;’first’, <strong>name</strong>&#41;</li>
<li>管理路由: @blue.route&#40;’路由’&#41;</li>
<li>第二步: 注册蓝图</li>
<li>flask对象.register_blueprint&#40;blueprint=blue, url_prefix=’/xxx’&#41;</li>
</ul>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><ul>
<li>直接重定向</li>
<li>redirect&#40;’/app/hello/‘&#41;: 直接重定向到某个地址</li>
<li>反向解析重定向</li>
<li>有参情况<ul>
<li>redirect&#40;url_for&#40;’生成蓝图的第一个参数.重定向的函数名, 参数=值’&#41;&#41;</li>
</ul>
</li>
<li>无参情况<ul>
<li>redirect&#40;url_for&#40;’生成蓝图的第一个参数.重定向的函数名’&#41;&#41;</li>
</ul>
</li>
</ul>
<h5 id="路由规则"><a href="#路由规则" class="headerlink" title="路由规则"></a>路由规则</h5><h5 id="格式-lt-转换器：参数-gt"><a href="#格式-lt-转换器：参数-gt" class="headerlink" title="格式: &lt;转换器：参数&gt;"></a>格式: &lt;转换器：参数&gt;</h5><p><a href="int:id" target="_blank" rel="noopener">int:id</a> 表示接受的id值为int类型</p>
<p><a href="string:name" target="_blank" rel="noopener">string:name</a>表示接收的name值为字符串类型，默认可简写为<name></name></p>
<p>&lt;float: price&gt;表示接收的price值为浮点数类型</p>
<p><a href="uuid:uid" target="_blank" rel="noopener">uuid:uid</a> 表示接收的uid值为uuid类型的参数</p>
<h5 id="path-p-表示接收的p参数为path路径"><a href="#path-p-表示接收的p参数为path路径" class="headerlink" title="path:p 表示接收的p参数为path路径"></a><a href="path:p" target="_blank" rel="noopener">path:p</a> 表示接收的p参数为path路径</h5><h2 id="错误抛出与捕获"><a href="#错误抛出与捕获" class="headerlink" title="错误抛出与捕获"></a>错误抛出与捕获</h2><p>导包: from flask import abort</p>
<p>使用: abort&#40;500&#41;</p>
<p>捕获: @blue.errorhandler&#40;500&#41;</p>
<p>抛出错误码时，错误码必须符合HTTP定义的状态码,且抛出的错误码要符合运用场景</p>
<h2 id="请求与响应"><a href="#请求与响应" class="headerlink" title="请求与响应"></a>请求与响应</h2><h4 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h4><ul>
<li>接收参数</li>
<li>GET请求: request.args.get&#40;key&#41;或request.args.getlist&#40;key&#41;</li>
<li>POST/PUT/PATCH/DELETE请求: request.form.get&#40;key&#41;或request.form.getlist&#40;key&#41;</li>
<li>获取请求方式</li>
<li>request.method</li>
<li>获取路由</li>
<li>request.path</li>
<li>获取cookie</li>
<li>request.cookies</li>
<li>获取文件</li>
<li>request.files</li>
</ul>
<h4 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h4><ul>
<li>创建: make_response&#40;响应内容, 响应状态码&#41;， 状态码默认为200，可不写。</li>
<li>响应对象.set_cookie&#40;key, value, max_age&#41;</li>
<li>响应对象.delete_cookie&#40;key&#41;</li>
</ul>
<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><ul>
<li>第一次访问任何一个路由地址时,在客户端，将在cookie中存储一个键值对，键为session，值为唯一的uuid类型的参数</li>
<li>第一次方式的同时，在服务端指定的redis中，也将存储cookie中的uuid值</li>
<li>如果用户登录成功，则可以像redis中存储的uuid参数中保存信息</li>
</ul>
<h4 id="flask自带形式"><a href="#flask自带形式" class="headerlink" title="flask自带形式"></a>flask自带形式</h4><ul>
<li>存储数据: 将session中存储的键值对内容存放在cookie中</li>
<li>存储方式: 设置secret_key参数，越复杂越好</li>
<li>使用方式:<br>from flask import session<br>session[‘key’] = value</li>
</ul>
<h3 id="使用flask-session第三方库"><a href="#使用flask-session第三方库" class="headerlink" title="使用flask-session第三方库"></a>使用flask-session第三方库</h3><ul>
<li>安装: pip install flask-session</li>
<li>配置存储的数据库:<br>flask对象.config[‘SESSION_TYPE’] = ‘redis’<br>flask对象.config[‘SESSION_REDIS’] = redis.Redis&#40;host, port, password&#41;</li>
<li>初始化:<br>from flask_session import Session<ul>
<li>第一种: Session&#40;flask对象&#41;</li>
<li>第二种:<br>se = Session&#40;&#41;<br>se.init_app&#40;flask对象&#41;</li>
</ul>
</li>
</ul>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h5 id="安装-pip-install-flask-sqlalchemy"><a href="#安装-pip-install-flask-sqlalchemy" class="headerlink" title="安装: pip install flask-sqlalchemy"></a>安装: pip install flask-sqlalchemy</h5><p>创建对象:</p>
<p>from flask_sqlalchemy import SQLALChemy<br>db = SQLALChemy&#40;&#41;</p>
<h3 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义:"></a>模型定义:</h3><p>class User&#40;db.Model&#41;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 定义自增的主键id</span><br><span class="line">id = db.Column(db.Integer, primary_key=True, autoincrement=True)</span><br><span class="line"># 定义长度为10的name字段，类型为字符串，唯一且不能为空</span><br><span class="line">name = db.Column(db.String(10), unique=True, nullable=False)</span><br><span class="line"># 定义密码password字段</span><br><span class="line">password = db.Column(db.String(249), nullable=False)</span><br><span class="line"></span><br><span class="line">__tablename__ = &apos;flask_user&apos;</span><br></pre></td></tr></table></figure>
<h3 id="配置链接"><a href="#配置链接" class="headerlink" title="配置链接:"></a>配置链接:</h3><p>flask对象.config[‘SQLALCHEMY_DATABASE_URI’]=’mysql+pymysql://root:<a href="mailto:123456@127.0.0.1" target="_blank" rel="noopener">123456@127.0.0.1</a>:2206/flask8’</p>
<p>初始化: db.init_app&#40;flask对象&#41;</p>
<h3 id="模型的映射"><a href="#模型的映射" class="headerlink" title="模型的映射"></a>模型的映射</h3><ul>
<li>创建: db.create_all&#40;&#41;</li>
<li>删除: db.drop_all&#40;&#41;</li>
</ul>
<h2 id="flask-login"><a href="#flask-login" class="headerlink" title="flask-login"></a>flask-login</h2><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><ul>
<li>加密: generate_password_hash&#40;&#41;</li>
<li>解密: check_password_hash&#40;&#41;</li>
</ul>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><ul>
<li>安装: pip install flask-login</li>
<li>初始化:<br>from flask_login import LoginManager<br>lm = LoginManager&#40;&#41;<br>lm.init_app&#40;flask对象&#41;</li>
<li>登录用户: login_user&#40;登录系统用户对象&#41;</li>
<li>退出用户: logout_user&#40;&#41;</li>
<li>登录校验: login_required</li>
<li>在模板中可使用&#123;&#123; current_user.name &#125;&#125;渲染登录系统的用户名信息</li>
<li>重点: 用户的模型中需继承UserMixin，或者自定义相关的属性与方法</li>
<li>必须定义回调user_loader，用于返回登录系统的用户对象</li>
</ul>
<p><em>XMind: ZEN - Trial Version</em></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/22/Flask框架脑图day-02/">
    <time datetime="2019-01-22T09:56:38.000Z" class="entry-date">
        2019-01-22
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask框架/">flask框架</a></li></ul>

    </footer>
</article>






  
    <article id="post-Django框架脑图" class="post-Django框架脑图 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/22/Django框架脑图/">Djangoæ框架脑图</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/22/Django框架脑图/" data-id="cjsk5l585001hl8ven9w6x3z9" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h1><h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><p>安装: pip install virtualenv</p>
<p>使用: virtualenv –no-site-packages -p D:\python3\python.exe name</p>
<ul>
<li>–no-site-packages: 表示创建的虚拟环境为纯净的环境，不安装有其他的库</li>
<li>-p: 表示虚拟环境中的python版本</li>
</ul>
<h3 id="pip使用"><a href="#pip使用" class="headerlink" title="pip使用"></a>pip使用</h3><ul>
<li>pip list: 插看安装的库</li>
<li>pip install xxx: 安装</li>
</ul>
<h3 id="激活虚拟环境"><a href="#激活虚拟环境" class="headerlink" title="激活虚拟环境"></a>激活虚拟环境</h3><ul>
<li>Windows: 直接执行activate命令</li>
<li>Mac/Linux/Ubuntu: 直接执行source activate命令</li>
</ul>
<h3 id="退出虚拟环境"><a href="#退出虚拟环境" class="headerlink" title="退出虚拟环境"></a>退出虚拟环境</h3><ul>
<li>Windows/Mac/Linux/Ubuntu: 直接执行deactivate</li>
</ul>
<h2 id="Django项目"><a href="#Django项目" class="headerlink" title="Django项目"></a>Django项目</h2><p>创建项目: django-amdin startproject 项目名称</p>
<p>创建应用: python manage.py startapp 应用名称</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><ul>
<li>启动命令: python manage.py runserver。默认IP为127.0.0.1  默认端口为8000</li>
<li>修改启动端口: python manage.py runserver 端口</li>
<li>修改IP和端口: python manage.py runserver IP:端口</li>
<li>IP参数: 如果为0.0.0.0表示任何人都可以通过公网IP访问django项目</li>
<li>端口PORT参数: 如果端口设置为80，表示该端口可以不用写</li>
</ul>
<h2 id="Django模式"><a href="#Django模式" class="headerlink" title="Django模式"></a>Django模式</h2><h3 id="M"><a href="#M" class="headerlink" title="M"></a>M</h3><ul>
<li>模型层: 定义模型和数据库中的表之间的关联关系</li>
</ul>
<h3 id="V"><a href="#V" class="headerlink" title="V"></a>V</h3><ul>
<li>视图层: 定义业务逻辑</li>
</ul>
<h3 id="T"><a href="#T" class="headerlink" title="T"></a>T</h3><ul>
<li>模板: HTML页面</li>
</ul>
<h2 id="数据库准备工作"><a href="#数据库准备工作" class="headerlink" title="数据库准备工作"></a>数据库准备工作</h2><h3 id="settings-py中配置"><a href="#settings-py中配置" class="headerlink" title="settings.py中配置"></a>settings.py中配置</h3><ul>
<li>USER参数: 访问用户</li>
<li>PASSWORD参数: 密码</li>
<li>HOST参数: 访问数据库的地址</li>
<li>PORT参数: 访问数据库的端口</li>
<li>NAME参数: 数据库名</li>
<li>‘OPTIONS’:&#123;’isolation_level’:None&#125;</li>
</ul>
<h3 id="安装pymysql"><a href="#安装pymysql" class="headerlink" title="安装pymysql"></a>安装pymysql</h3><ul>
<li>使用pymysql连接数据库: 因为python3没有MySQLdb驱动，无法直接连接MySQL</li>
<li>在工程目录的<strong>init</strong>.py文件中定义  pymysql.install_as_MySQLdb&#40;&#41;</li>
</ul>
<h3 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h3><ul>
<li>第一次迁移: python manege.py migrate</li>
<li>除开第一次迁移</li>
<li>生成迁移文件: python manage.py makemigrations</li>
<li>执行迁移文件: python manage.py migrate</li>
</ul>
<h3 id="插入管理员账号"><a href="#插入管理员账号" class="headerlink" title="插入管理员账号"></a>插入管理员账号</h3><ul>
<li>python manage.py createsuperuser</li>
</ul>
<h2 id="模型层"><a href="#模型层" class="headerlink" title="模型层"></a>模型层</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li>objects: 管理器，默认模型的属性</li>
<li>ORM&#40;objects relationship mapping&#41;: 对象关系映射</li>
</ul>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><ul>
<li>create&#40;&#41;方法: 模型名.objects.create&#40;字段1=值,字段2=值&#41;</li>
<li>save&#40;&#41;方法: 模型对象.save&#40;&#41;</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul>
<li>delete&#40;&#41;方法: 模型名.objects.filter&#40;条件&#41;.delete&#40;&#41;</li>
</ul>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><ul>
<li>update&#40;&#41;方法: 模型名.objects.filter&#40;条件&#41;.update&#40;字段1=值,字段2=值&#41;</li>
<li>save&#40;&#41;方法: 模型对象.save&#40;&#41;</li>
<li>update&#40;&#41;和save&#40;&#41;的区别: 是否更新使用auto_now约束条件的字段</li>
</ul>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><ul>
<li>filter&#40;&#41;方法,查询满足条件的信息: 模型名.objects.filter&#40;条件&#41;</li>
<li>all&#40;&#41;方法: 查询所有</li>
<li>get&#40;&#41;方法: 查询指定的条件</li>
<li>只能返回唯一的一个对象结果</li>
<li>条件必须成立</li>
<li>first&#40;&#41;方法: 取出结果中的第一个对象</li>
<li>exclude&#40;&#41;方法: 查询出不满足条件的信息: 模型名.objects.exclude&#40;条件&#41;</li>
<li>order_by&#40;&#41;方法: 升序order_by&#40;’id’&#41;  降序order_by&#40;’-id’&#41;</li>
<li>values&#40;&#41;方法: 取查询对象中的字段</li>
<li>exists&#40;&#41;: 判断结果是否存在,存在返回True,否则返回False</li>
<li>count&#40;&#41;方法: 计算结果的条数</li>
<li>pk: 主键（就是id）</li>
<li>运算符</li>
<li>语法:  字段__contains</li>
<li>contains: 包含</li>
<li>startswith: 以什么开头</li>
<li>endswith: 以什么结束</li>
<li>in: 在某个范围之内</li>
<li>gt,gte: 大于,大于等于</li>
<li>lt,lte: 小于,小于等于</li>
<li>聚合</li>
<li>from django.db.models import Max, Avg, Min, Sum, Count</li>
<li>语法: 模型名.objects.all&#40;&#41;.aggregate&#40;Sum&#40;字段&#41;&#41;</li>
<li>Q</li>
<li>与1: Q&#40;条件1&#41;, Q&#40;条件2&#41;</li>
<li>与2: Q&#40;条件1&#41; &amp; Q&#40;条件2&#41;</li>
<li>或: Q&#40;条件1&#41; | Q&#40;条件2&#41;</li>
<li>非: ~Q&#40;条件1&#41;</li>
<li>F</li>
<li>用于比较两个字段,可使用+,-符号</li>
<li>模型名.objects.filter&#40;wuli__gt=F&#40;’math’&#41;-10&#41;</li>
</ul>
<h2 id="模型设计"><a href="#模型设计" class="headerlink" title="模型设计"></a>模型设计</h2><h3 id="迁移表名的定义"><a href="#迁移表名的定义" class="headerlink" title="迁移表名的定义"></a>迁移表名的定义</h3><ul>
<li>指定db_table参数，表示模型迁移时，映射到数据库中的表名称</li>
<li>如果没指定db_table参数,则数据库中模型映射的表名为: 应用名app_模型名称的小写</li>
</ul>
<h3 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h3><ul>
<li>CharField: 字符串类型</li>
<li>IntegerField: 整型</li>
<li>ImageField: 字符串类型,用于存图片</li>
<li>BooleanField: 布尔， True 或者 False</li>
<li>DateTimeField: 日期, 年月日时分秒</li>
<li>DateField: 年月日</li>
<li>TextField: 存储长文本内容, areatext标签</li>
<li>FloatField: 浮点类型</li>
<li>DecimalField: 浮点类型，限制最大长度和小数点后的长度</li>
</ul>
<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><ul>
<li>unique: 是否唯一</li>
<li>default: 默认值</li>
<li>null: 是否可以为空</li>
<li>primary_key: 主键</li>
<li>auto_now_add: 创建时，默认赋值为当前时间</li>
<li>auto_now: 创建或修改时，默认赋值为当前时间</li>
<li>max_length: 最大长度</li>
<li>related_name: 反向查询名称</li>
<li>on_delete: 删除的约束条件</li>
<li>models.CASCADE 删除主表，从表也会被删</li>
<li>models.PROTECT 不让删除主表</li>
<li>models.SET_NULL 删除主表，从表的关联字段设置为空</li>
</ul>
<h3 id="一对一，1-1"><a href="#一对一，1-1" class="headerlink" title="一对一，1:1"></a>一对一，1:1</h3><ul>
<li>存储</li>
<li>关联字段存储1： stu_info.关联字段 = 关联对象</li>
<li>关联字段存储2: stu_info.关联字段_id = 主键id值</li>
<li>查询</li>
<li>学生模型和学生拓展模型的定义，一对一</li>
<li>查询1,没设置related_name参数时<ul>
<li>学生对象查询拓展表对象:  学生对象.拓展模型名称的小写</li>
<li>拓展表对象查询学生对象: 拓展表对象.OneToOneField定义的字段</li>
</ul>
</li>
<li>查询2, 设置related_name参数时<ul>
<li>学生对象查询拓展表对象: 对象对象.related_name参数</li>
<li>拓展表对象查询学生对象: 拓展表对象.OneToOneField定义的字段</li>
</ul>
</li>
<li>定义模型</li>
<li>OneToOneField: 定义在关联模型的任何一方都可以</li>
</ul>
<h3 id="一对多，1-N"><a href="#一对多，1-N" class="headerlink" title="一对多，1:N"></a>一对多，1:N</h3><ul>
<li>存储</li>
<li>关联字段的存储1: stu.关系字段 = 关联模型对象</li>
<li>关联字段的存储2: stu.关系字段_id = 关联表的主键id值</li>
<li>查询</li>
<li>查询1: 没有定义related_name参数<ul>
<li>学生查询班级: 多的一方&#40;学生&#41;对象.关联字段</li>
<li>班级查询学生: 一的一方（班级）.关联模型名的小写_set.filter&#40;&#41;.all&#40;&#41;</li>
</ul>
</li>
<li>查询2: 设置了related_name参数<ul>
<li>学生查询班级: 多的一方（学生）对象.关联字段</li>
<li>班级查询学生: 一的一方&#40;班级&#41;.related_name参数.filter&#40;&#41;.all&#40;&#41;</li>
</ul>
</li>
<li>定义模型</li>
<li>ForeignKey: 定义在多&#40;N&#41;的一方</li>
</ul>
<h3 id="多对多-N-M"><a href="#多对多-N-M" class="headerlink" title="多对多, N:M"></a>多对多, N:M</h3><ul>
<li>存储: 同一对多</li>
<li>查询</li>
<li>查询1: 没有设置related_name参数<ul>
<li>课程查询学生: 课程对象.关联字段.filter&#40;&#41;</li>
<li>学生查询课程: 学生对象.关联模型名的小写_set</li>
</ul>
</li>
<li>查询2: 设置了related_name参数<ul>
<li>课程查询学生: 课程对象.关联字段.filter&#40;&#41;.all&#40;&#41;</li>
<li>学生查询课程: 学生对象.related_name参数.filter&#40;&#41;.all&#40;&#41;</li>
</ul>
</li>
<li>定义模型</li>
<li>ManyToManyField: 定义在模型的任何一方都可以</li>
</ul>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><h3 id="解析模板文件的位置"><a href="#解析模板文件的位置" class="headerlink" title="解析模板文件的位置"></a>解析模板文件的位置</h3><ul>
<li>配置: 在settings.py文件中定义TEMPALTES的目录地址</li>
<li>os.path.join&#40;BASE_DIR, ‘templates’&#41;</li>
</ul>
<h3 id="后端渲染模板"><a href="#后端渲染模板" class="headerlink" title="后端渲染模板"></a>后端渲染模板</h3><ul>
<li>使用render&#40;&#41;渲染模板</li>
<li>传递参数给模板, render&#40;request, 模板名, &#123;key1:value1, key2: value2&#125;&#41;</li>
</ul>
<h3 id="前端渲染数据"><a href="#前端渲染数据" class="headerlink" title="前端渲染数据"></a>前端渲染数据</h3><ul>
<li>解析变量: &#123;&#123; 变量 &#125;&#125;</li>
<li>标签for中自带的变量forloop<ul>
<li>从1开始: &#123;&#123; forloop.counter &#125;&#125;</li>
<li>从0开始: &#123;&#123; forloop.counter0 &#125;&#125;</li>
<li>倒序1结束: &#123;&#123; forloop.revcounter &#125;&#125;</li>
<li>倒序0结束: &#123;&#123; forloop.revcounter0 &#125;&#125;</li>
<li>判断循环第一次: &#123;&#123; forloop.first &#125;&#125;, 返回布尔值</li>
<li>判断循环最后一次: &#123;&#123; forloop.last &#125;&#125;, 返回布尔值</li>
</ul>
</li>
<li>解析标签: &#123;% 标签 %&#125; &#123;% end标签 %&#125;</li>
<li>标签: for<ul>
<li>&#123;% for i in xxx %&#125; &#123;% empty %&#125;  &#123;% endfor %&#125;</li>
</ul>
</li>
<li>标签: if<ul>
<li>&#123;% if name %&#125; &#123;% else %&#125; &#123;% endif %&#125;</li>
</ul>
</li>
<li>标签: ifequal<ul>
<li>&#123;% ifeuqal forloop.counter 值 %&#125;  &#123;% endifequal %&#125;</li>
</ul>
</li>
<li>注解</li>
<li>web形式注解: <!--  注解内容-->, 需注意不能定义错误的标签语法</li>
<li>django框架中的单行注解: &#123;# 注解内容 #&#125;</li>
<li>django框架中的多行注解: &#123;% comment %&#125;  &#123;% endcomment %&#125;</li>
</ul>
<h3 id="引入静态文件"><a href="#引入静态文件" class="headerlink" title="引入静态文件"></a>引入静态文件</h3><ul>
<li>第一种: <link rel="stylesheet" href="/static/css/style.css"></li>
<li>第二种: &#123;% load static %&#125;    <link rel="stylesheet" href="&#123;% static 'css/style.css' %&#125;"></li>
</ul>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><ul>
<li>语法: &#123;&#123; a | 过滤器 &#125;&#125;</li>
<li>safe: 解析变量中的样式</li>
<li>upper/lower: 变量的大小写转换</li>
<li>default: 默认值</li>
<li>first/last: 取出变量中的首/尾元素</li>
<li>length: 计算变量的长度</li>
</ul>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><ul>
<li>父模板&#40;挖坑&#41;</li>
<li>概念: 定义好可以被子模板动态填充内容的block块</li>
<li>定义block块的名字不能重复</li>
<li>子模板&#40;填坑&#41;</li>
<li>概念: 继承于父模板，并实现填充block块的内容</li>
<li>定义的block块的名字一定要存在于父模板中</li>
<li>继承: &#123;% extends ‘父模板’ %&#125;</li>
<li>动态填充block块的内容: &#123;% block 名称 %&#125; &#123;% endblock %&#125;</li>
<li>获取父模板中坑之前定义好的内容: &#123;&#123; block.super &#125;&#125;</li>
</ul>
<h2 id="路由URLS"><a href="#路由URLS" class="headerlink" title="路由URLS"></a>路由URLS</h2><h3 id="配置路由分发"><a href="#配置路由分发" class="headerlink" title="配置路由分发"></a>配置路由分发</h3><ul>
<li>path&#40;’app/‘, include&#40;’app.urls’&#41;&#41;,</li>
<li>path&#40;’app/‘, include&#40;&#40;’app.urls’, ‘app’&#41;&#41;&#41;</li>
</ul>
<h3 id="接收参数"><a href="#接收参数" class="headerlink" title="接收参数"></a>接收参数</h3><ul>
<li>path</li>
<li>接收整型:<a href="int:id" target="_blank" rel="noopener">int:id</a> 其中id参数为int类型</li>
<li>接收字符串: &lt;str: name&gt; 其中name参数为str类型</li>
<li>接收uuid类型: &lt;uuid: uid&gt; 其中uid参数为uuid类型的值</li>
<li>接收path路径: &lt;path: path&gt; 其中path参数为路径</li>
<li>注意: 接收参数的方法中，需要指定接收参数的变量名</li>
<li>re_path</li>
<li>re_path: /index/&#40;\d+&#41;/其中路由匹配的值为int类型</li>
<li>re_path&#40;’params/&#40;\d+&#41;/&#40;\d+&#41;/&#40;\d+&#41;/‘, views.params&#41;: 注意方法中接收参数的定义顺序和路由中定义的正则表达式的顺序一致</li>
<li>re_path&#40;’params/&#40;?P<year>\d+&#41;/&#40;?P<month>\d+&#41;/&#40;?P<day>\d+&#41;/‘, views.params&#41;: 定义路由中接收参数的名字，分别为year，month，day</day></month></year></li>
</ul>
<h2 id="请求request"><a href="#请求request" class="headerlink" title="请求request"></a>请求request</h2><h3 id="请求方式method-GET-POST"><a href="#请求方式method-GET-POST" class="headerlink" title="请求方式method: GET,POST"></a>请求方式method: GET,POST</h3><ul>
<li>GET方式: 用于查询数据</li>
<li>POST方式: 用于增、删、改数据</li>
</ul>
<h3 id="传参GET"><a href="#传参GET" class="headerlink" title="传参GET"></a>传参GET</h3><ul>
<li>获取get请求传递的参数</li>
<li>request.GET[‘key’]</li>
<li>request.GET.get&#40;’key’&#41;</li>
</ul>
<h3 id="传参POST"><a href="#传参POST" class="headerlink" title="传参POST"></a>传参POST</h3><ul>
<li>获取post请求传递的参数</li>
<li>request.POST[‘key’]</li>
<li>request.POST.get[‘key’]</li>
</ul>
<h3 id="传参FILES"><a href="#传参FILES" class="headerlink" title="传参FILES"></a>传参FILES</h3><ul>
<li>获取上传的文件、图片等内容</li>
<li>request.FILES[‘key]</li>
<li>request.FILES.get&#40;’key’&#41;</li>
</ul>
<h3 id="路径path"><a href="#路径path" class="headerlink" title="路径path"></a>路径path</h3><ul>
<li>获取当前请求的路径</li>
<li>request.path</li>
</ul>
<h3 id="COOKIES"><a href="#COOKIES" class="headerlink" title="COOKIES"></a>COOKIES</h3><ul>
<li>存储网站的一些基本信息: 如登录的信息</li>
<li>COOKIES存储的内容是存储在客户端&#40;浏览器&#41;</li>
<li>request.COOKIES[‘key’]或request.COOKIES.get&#40;’key’&#41;</li>
</ul>
<h2 id="响应response"><a href="#响应response" class="headerlink" title="响应response"></a>响应response</h2><p>HttpResponse: 响应字符串</p>
<p>JsonResponse: 响应json，用于ajax异步请求</p>
<p>render: 渲染页面</p>
<h5 id="HttpResponseRedirect-跳转"><a href="#HttpResponseRedirect-跳转" class="headerlink" title="HttpResponseRedirect: 跳转"></a>HttpResponseRedirect: 跳转</h5><ul>
<li>第一种: 硬编码跳转地址， HttpResponseRedirect&#40;’/app/index/1/‘&#41;</li>
<li>第二种: 反向解析跳转地址: HttpResponseRedirect&#40;reverse&#40;’namespace:name’, kwargs=&#123;key:value&#125;&#41;&#41;</li>
</ul>
<h2 id="cookie与session"><a href="#cookie与session" class="headerlink" title="cookie与session"></a>cookie与session</h2><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><ul>
<li>产生背景: 由于http无状态协议，导致后端无法知道当前发送请求的人是‘谁’</li>
<li>用于存储一些不是很重要的内容</li>
<li>存储: set_cookie&#40;key, value, max_age,expris&#41;</li>
<li>删除: delete_cookie&#40;key&#41;</li>
</ul>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><ul>
<li>产生背景: 由于cookie中存储空间有限，很容易被截取，因此cookie存重要内容不安全，需要使用session进行数据存储</li>
<li>向session中存数据: request.session[key]=value</li>
<li>取session中存的数据: request.session[‘key’]或request.session.get&#40;’key’&#41;</li>
<li>删除cookie和session中所有信息: request.session.flush&#40;&#41;</li>
<li>删除user_id键值对: del request.session[‘user_id’]</li>
</ul>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>概念: 面向切面编程AOP, 在整个的请求与响应之间插入一些额外的功能代码</p>
<h3 id="五个中间件函数"><a href="#五个中间件函数" class="headerlink" title="五个中间件函数"></a>五个中间件函数</h3><ul>
<li>process_request&#40;self, request&#41;: 在匹配路由之前被调用</li>
<li>process_view&#40;self, request, view_func, view_args, view_kwargs&#41;: 在执行视图函数之前被调用</li>
<li>process_response&#40;self,request, response&#41;: 在视图函数响应之后被调用&#41;</li>
<li>process_template_response&#40;&#41;: 默认不会被主动调用</li>
<li>process_exception&#40;&#41;: 默认不会被主动调用，当出现异常时，才会被触发</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>process_request中不要写return http响应对象。可以return None表示不再执行以下的代码，直接跳出process_request方法</li>
<li>process_response: 必须响应内容return response</li>
</ul>
<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><h3 id="使用切片实现"><a href="#使用切片实现" class="headerlink" title="使用切片实现"></a>使用切片实现</h3><h3 id="使用Paginator实现"><a href="#使用Paginator实现" class="headerlink" title="使用Paginator实现"></a>使用Paginator实现</h3><ul>
<li>pg = Paginator&#40;总数据, 分页条数&#41;</li>
<li>取某一页信息: pg.page&#40;某页&#41;</li>
<li>page_range: 页码</li>
<li>has_previous: 是否有上一页</li>
<li>previous_page_number: 上一页的脚码</li>
<li>has_next: 是否有下一页</li>
<li>next_page_numebr: 下一页的脚码</li>
<li>number: 当前页</li>
<li>num_pages: 共多少页</li>
</ul>
<h2 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h2><p>前端模板: form表单中需要添加enctype=”multipart/form-data”</p>
<p>后端: 获取图片request.FILES.get&#40;key&#41;或request.FILES[‘key’]</p>
<p>模型定义: ImageField&#40;upload_to=’upload’&#41;, 需安装pip install Pillow</p>
<p>模板中解析:&lt;img src=’/media/&#123;&#123; stu.icon &#125;&#125;&gt;</p>
<p>配置访问media文件的路由地址</p>
<ul>
<li>导包: from django.contrib.staticfiles.urls import static</li>
<li>urlpatterns += static&#40;MEDIA_URL, document_root=MEDIA_ROOT&#41;</li>
</ul>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/22/Django框架脑图/">
    <time datetime="2019-01-22T09:44:04.000Z" class="entry-date">
        2019-01-22
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/框架/">框架</a></li></ul>

    </footer>
</article>






  
    <article id="post-文章编辑器模板" class="post-文章编辑器模板 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/14/文章编辑器模板/">文章编辑器模板</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/14/文章编辑器模板/" data-id="cjsk5l57t001bl8veku90vrh3" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>登录注册注销首页文章编辑展示的路由:</p>
<p><img src="images/QQ图片20190114090018.jpg" alt=""></p>
<p>登录状态校验中间件:</p>
<p><img src="images/QQ图片20190114090034.png" alt=""></p>
<p>日志中间件：</p>
<p><img src="images/QQ图片20190114090042.png" alt=""></p>
<p>模板文件:</p>
<p><img src="images/QQ图片20190114090048.png" alt=""></p>
<h1 id="django项目对接富文本编辑器kindeditor的使用"><a href="#django项目对接富文本编辑器kindeditor的使用" class="headerlink" title="django项目对接富文本编辑器kindeditor的使用"></a>django项目对接富文本编辑器kindeditor的使用</h1><blockquote>
<p>Auth: 王海飞</p>
<p>Data：2018-09-07</p>
<p>Email：<a href="mailto:779598160@qq.com" target="_blank" rel="noopener">779598160@qq.com</a></p>
<p>github：<a href="https://github.com/coco369/knowledge" target="_blank" rel="noopener">https://github.com/coco369/knowledge</a></p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在Django中经常使用富文本编辑来编辑文本内容。富文本编辑器有很多可以选择，比如baiduEditor，tinymce，kindeditor等等。在此我选择使用kindeditor富文本编辑器，KindEditor 使用 JavaScript 编写，可以无缝地与 Java、.NET、PHP、ASP 等程序集成，很适合做网站的文本编辑器来使用。</p>
<h3 id="1-kindeditor下载与配置"><a href="#1-kindeditor下载与配置" class="headerlink" title="1. kindeditor下载与配置"></a>1. kindeditor下载与配置</h3><p>下载 KindEditor 最新版本，下载之后打开 examples/index.html 就可以看到演示。</p>
<p>步骤1： 下载<a href="http://www.kindsoft.net/down.php" target="_blank" rel="noopener">传送门地址</a></p>
<p>步骤2： 将下载的kindeditor解压，并删除无用的asp、jsp、php等配置文件夹。</p>
<p>步骤3： 将kindeditor文件夹拷贝放在static中</p>
<p>如：</p>
<p><img src="images/django_kindeditor.png" alt="图"></p>
<h3 id="2-Django中配置"><a href="#2-Django中配置" class="headerlink" title="2. Django中配置"></a>2. Django中配置</h3><p>要使用kindeditor富文本编辑器需要在settings.py文件中配置静态static解析路径，以及media文件解析路径。并且在页面中进行相关js的加载，和上传路径的指定等。</p>
<h4 id="2-1-在settings-py中配置如下参数："><a href="#2-1-在settings-py中配置如下参数：" class="headerlink" title="2.1 在settings.py中配置如下参数："></a>2.1 在settings.py中配置如下参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = &apos;/static/&apos;</span><br><span class="line"># 配置static的路径</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, &apos;static&apos;)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MEDIA_URL = &apos;/media/&apos;</span><br><span class="line"># 配置media的路径</span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, &apos;media&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-页面中加载富文本编辑器，引入js，定义uploadJson上传地址，实例化富文本输入框"><a href="#2-2-页面中加载富文本编辑器，引入js，定义uploadJson上传地址，实例化富文本输入框" class="headerlink" title="2.2 页面中加载富文本编辑器，引入js，定义uploadJson上传地址，实例化富文本输入框"></a>2.2 页面中加载富文本编辑器，引入js，定义uploadJson上传地址，实例化富文本输入框</h4><p>步骤1：引入js, 定义上传图片等文件的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &apos;base.html&apos; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    文章编辑页面</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block Js %&#125;</span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;&#123;% static &apos;kindeditor/kindeditor-all.js&apos; %&#125;&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;&#123;% static &apos;kindeditor/lang/zh-CN.js&apos; %&#125;&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        KindEditor.ready(function(K) &#123;</span><br><span class="line">                window.editor = K.create(&apos;#editor_id&apos;,&#123;</span><br><span class="line">                    uploadJson:&apos;/util/upload/kindeditor&apos;</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">        &#123;% csrf_token %&#125;</span><br><span class="line">        &#123;&#123; msg &#125;&#125;</span><br><span class="line">        标题：&lt;input type=&quot;text&quot; name=&quot;title&quot;&gt;</span><br><span class="line">        内容：&lt;textarea id=&quot;editor_id&quot; name=&quot;content&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;/p&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>uploadJson参数为:’/util/upload/kindeditor’，该URL实现了上传文件的方法。该URL对应的视图函数，在步骤3中定义。</p>
</li>
<li><p>初始化定义富文本编辑器的对象</p>
<textarea id="editor_id" name="content"> </textarea>

</li>
</ol>
<p>步骤3：定义uploadJson实现的方法</p>
<p>a）在urls.py中定义处理上传文件的URL规则</p>
<p>在工程目录的urls.py文件中定义上传图片的配置和访问media路径的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path, include, re_path</span><br><span class="line">from django.contrib.staticfiles.urls import static</span><br><span class="line"></span><br><span class="line">from utils.upload_image import upload_image</span><br><span class="line"></span><br><span class="line"> # kindeditor编辑器上传图片地址</span><br><span class="line">re_path(r&apos;^util/upload/(?P&lt;dir_name&gt;[^/]+)$&apos;, upload_image, name=&apos;upload_image&apos;),</span><br><span class="line"></span><br><span class="line"># 配置media访问路径</span><br><span class="line">urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</span><br></pre></td></tr></table></figure>
<p>应用app的urls.py中定义编辑和列表的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 编辑文章</span><br><span class="line">path(r&apos;edit_article/&apos;, views.edit_article, name=&apos;edit_article&apos;),</span><br><span class="line"># 文章列表</span><br><span class="line">path(r&apos;article/&apos;, views.article, name=&apos;article&apos;),</span><br></pre></td></tr></table></figure>
<p>b）在utils中定义upload_images文件，并定义upload_image函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.conf import settings</span><br><span class="line">from django.views.decorators.csrf import csrf_exempt</span><br><span class="line">import os</span><br><span class="line">import uuid</span><br><span class="line">import json</span><br><span class="line">import datetime as dt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@csrf_exempt</span><br><span class="line">def upload_image(request, dir_name):</span><br><span class="line">    ##################</span><br><span class="line">    #  kindeditor图片上传返回数据格式说明：</span><br><span class="line">    # &#123;&quot;error&quot;: 1, &quot;message&quot;: &quot;出错信息&quot;&#125;</span><br><span class="line">    # &#123;&quot;error&quot;: 0, &quot;url&quot;: &quot;图片地址&quot;&#125;</span><br><span class="line">    ##################</span><br><span class="line">    result = &#123;&quot;error&quot;: 1, &quot;message&quot;: &quot;上传出错&quot;&#125;</span><br><span class="line">    files = request.FILES.get(&quot;imgFile&quot;, None)</span><br><span class="line">    if files:</span><br><span class="line">        result =image_upload(files, dir_name)</span><br><span class="line">    return HttpResponse(json.dumps(result), content_type=&quot;application/json&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#目录创建</span><br><span class="line">def upload_generation_dir(dir_name):</span><br><span class="line">    today = dt.datetime.today()</span><br><span class="line">    dir_name = dir_name + &apos;/%d/%d/&apos; %(today.year,today.month)</span><br><span class="line">    if not os.path.exists(settings.MEDIA_ROOT + dir_name):</span><br><span class="line">        os.makedirs(settings.MEDIA_ROOT + dir_name)</span><br><span class="line">    return dir_name</span><br><span class="line"></span><br><span class="line"># 图片上传</span><br><span class="line">def image_upload(files, dir_name):</span><br><span class="line">    #允许上传文件类型</span><br><span class="line">    allow_suffix =[&apos;jpg&apos;, &apos;png&apos;, &apos;jpeg&apos;, &apos;gif&apos;, &apos;bmp&apos;]</span><br><span class="line">    file_suffix = files.name.split(&quot;.&quot;)[-1]</span><br><span class="line">    if file_suffix not in allow_suffix:</span><br><span class="line">        return &#123;&quot;error&quot;: 1, &quot;message&quot;: &quot;图片格式不正确&quot;&#125;</span><br><span class="line">    relative_path_file = upload_generation_dir(dir_name)</span><br><span class="line">    path=os.path.join(settings.MEDIA_ROOT, relative_path_file)</span><br><span class="line">    if not os.path.exists(path): #如果目录不存在创建目录</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">    file_name=str(uuid.uuid1())+&quot;.&quot;+file_suffix</span><br><span class="line">    path_file=os.path.join(path, file_name)</span><br><span class="line">    file_url = settings.MEDIA_URL + relative_path_file + file_name</span><br><span class="line">    open(path_file, &apos;wb&apos;).write(files.file.read()) # 保存图片</span><br><span class="line">    return &#123;&quot;error&quot;: 0, &quot;url&quot;: file_url&#125;</span><br></pre></td></tr></table></figure>
<p>步骤4：实现编辑上传功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">def edit_article(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    文章编辑方法</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if request.method == &apos;GET&apos;:</span><br><span class="line">        return render(request, &apos;edit.html&apos;)</span><br><span class="line">    if request.method == &apos;POST&apos;:</span><br><span class="line">        # 获取文章的标题和内容</span><br><span class="line">        title = request.POST.get(&apos;title&apos;)</span><br><span class="line">        content = request.POST.get(&apos;content&apos;)</span><br><span class="line">        # 使用all()方法进行判断，如果文章标题和内容任何一个参数没有填写，则返回错误信息</span><br><span class="line">        if not all([title, content]):</span><br><span class="line">            msg = &apos;请填写完整的参数&apos;</span><br><span class="line">            return render(request, &apos;edit.html&apos;, &#123;&apos;msg&apos;: msg&#125;)</span><br><span class="line">        # 创建文章</span><br><span class="line">        Article.objects.create(title=title,</span><br><span class="line">                               content=content)</span><br><span class="line">        # 创建文章成功后，跳转到文章列表页面</span><br><span class="line">        return HttpResponseRedirect(reverse(&apos;users:article&apos;))</span><br><span class="line"></span><br><span class="line">def article(request):</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">文章展示方法</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">if request.method == &apos;GET&apos;:</span><br><span class="line">    # 获取所有的文章</span><br><span class="line">    articles = Article.objects.all()</span><br><span class="line">    return render(request, &apos;article.html&apos;, &#123;&apos;articles&apos;: articles&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-文件上传media文件中的展示"><a href="#3-文件上传media文件中的展示" class="headerlink" title="3. 文件上传media文件中的展示"></a>3. 文件上传media文件中的展示</h3><p><img src="images/django_kindeditor_mediapng.png" alt=""></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/14/文章编辑器模板/">
    <time datetime="2019-01-14T01:10:00.000Z" class="entry-date">
        2019-01-14
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/框架/">框架</a></li></ul>

    </footer>
</article>






  
  
    <nav id="pagination">
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
      </nav>
    </nav>
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s">
        <input type="submit" id="searchsubmit" value="搜索">
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2019/02/21/linux系统MySql操作/">linux系统MySql操作</a>
          </li>
        
          <li>
            <a href="/2019/02/19/linux中msql操作/">linux中msql操作</a>
          </li>
        
          <li>
            <a href="/2019/02/19/操作命令/">操作命令</a>
          </li>
        
          <li>
            <a href="/2019/02/16/flask项目部署/">flask项目部署</a>
          </li>
        
          <li>
            <a href="/2019/02/15/django项目部署/">django项目部署</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux学习/">Linux学习</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask框架/">flask框架</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/框架/">框架</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/Linux学习/" style="font-size: 13.33px;">Linux学习</a> <a href="/tags/flask框架/" style="font-size: 13.33px;">flask框架</a> <a href="/tags/数据库/" style="font-size: 16.67px;">数据库</a> <a href="/tags/框架/" style="font-size: 20px;">框架</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2019 John Doe
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/js/share.js'];</script>

<script src="/js/jquery-3.3.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>